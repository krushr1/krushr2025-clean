#!/bin/bash

# /push - Custom Claude Code command to push all pending changes
# Usage: /push [optional commit message]

set -e

# Change to project root
cd "$(dirname "$0")/../.."

echo "ğŸ” Checking for pending changes..."

# Check if there are any changes to commit
if git diff --quiet && git diff --cached --quiet; then
    echo "âœ… No changes to commit"
    
    # Check if we're ahead of origin
    if git status --porcelain=v1 2>/dev/null | grep -q "^##.*ahead"; then
        echo "ğŸ“¤ Pushing existing commits to remote..."
        git push origin main
        echo "âœ… All commits pushed successfully"
    else
        echo "âœ… Already up to date with remote"
    fi
    exit 0
fi

# Get commit message from argument or use default
COMMIT_MSG="${1:-"Update project files

Automated commit of pending changes via /push command.

ğŸ¤– Generated with [Claude Code](https://claude.ai/code)

Co-Authored-By: Claude <noreply@anthropic.com>"}"

echo "ğŸ“ Staging all changes..."
git add .

echo "ğŸ’¾ Committing changes..."
git commit -m "$COMMIT_MSG"

echo "ğŸ“¤ Pushing to remote..."
git push origin main

echo "âœ… All pending changes successfully pushed!"
echo "ğŸ“Š Repository status:"
git status --short