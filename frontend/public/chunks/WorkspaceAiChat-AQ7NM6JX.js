import{d as R,f as W}from"/chunks/chunk-S56UMUFQ.js";import{c as n}from"/chunks/chunk-ISVWCGWF.js";import{c as i}from"/chunks/chunk-CCWXO4F3.js";import{a as P}from"/chunks/chunk-QTRZSSLA.js";import{k as C,m as A}from"/chunks/chunk-5XJTT5XM.js";import"/chunks/chunk-VWA4A2GI.js";import"/chunks/chunk-LIN3LNLL.js";import{Aa as w,E,Fa as z,Na as K,_a as L,b as y,c as G,d as T,eb as k,f as b,q as o,qa as F}from"/chunks/chunk-PGPPHKG2.js";var a=y(G(),1);var e=y(T(),1);function V({workspaceId:l,className:$}){let[r,x]=(0,a.useState)(null),[m,S]=(0,a.useState)(""),[c,D]=(0,a.useState)(8e3),[p,d]=(0,a.useState)(!1),[I,u]=(0,a.useState)(!1),Q=(0,a.useRef)(null),v=(0,a.useRef)(null),{user:j}=R(),{data:t,refetch:H}=i.ai.getConversations.useQuery({workspaceId:l}),{data:g}=i.ai.getConversation.useQuery({conversationId:r},{enabled:!!r}),{data:h}=i.ai.getUsageStats.useQuery({workspaceId:l,days:30}),f=i.ai.createConversation.useMutation({onSuccess:s=>{x(s.id),H(),u(!1)}}),U=i.ai.sendMessage.useMutation({onSuccess:()=>{S(""),d(!1)},onError:()=>{d(!1)}});(0,a.useEffect)(()=>{v.current&&v.current.scrollIntoView({behavior:"smooth"})},[g?.messages]),(0,a.useEffect)(()=>{!r&&t&&t.length>0&&x(t[0].id)},[t,r]);let B=async()=>{if(!m.trim())return;let s=r;s||(d(!0),s=(await f.mutateAsync({workspaceId:l,title:void 0,context:"Workspace AI assistant"})).id),d(!0),await U.mutateAsync({conversationId:s,message:m,thinkingBudget:c})},q=s=>{s.key==="Enter"&&!s.shiftKey&&(s.preventDefault(),B())},M=s=>s<.01?"<$0.01":`$${s.toFixed(3)}`,N=s=>s>1e3?`${(s/1e3).toFixed(1)}K`:s.toString();return(0,e.jsxs)("div",{className:b("h-full flex flex-col bg-white",$),children:[(0,e.jsxs)("div",{className:"flex items-center justify-between p-3 border-b border-gray-200 bg-gradient-to-r from-krushr-primary/5 to-transparent",children:[(0,e.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,e.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,e.jsxs)("div",{className:"relative",children:[(0,e.jsx)(o,{className:"w-5 h-5 text-krushr-primary"}),(0,e.jsx)(K,{className:"w-3 h-3 text-yellow-500 absolute -top-1 -right-1"})]}),(0,e.jsxs)("div",{children:[(0,e.jsx)("h3",{className:"font-semibold text-sm text-gray-900",children:"AI Assistant"}),(0,e.jsx)("p",{className:"text-xs text-gray-500",children:"Gemini 2.5 Flash"})]})]}),h&&(0,e.jsxs)("div",{className:"hidden md:flex items-center space-x-3 text-xs text-gray-500",children:[(0,e.jsxs)("div",{className:"flex items-center space-x-1",children:[(0,e.jsx)(k,{className:"w-3 h-3"}),(0,e.jsx)("span",{children:N(h.totalStats.totalTokens)})]}),(0,e.jsx)("div",{className:"flex items-center space-x-1",children:(0,e.jsx)("span",{children:M(h.totalStats.totalCost)})})]})]}),(0,e.jsxs)("div",{className:"flex items-center space-x-1",children:[t&&t.length>0&&(0,e.jsxs)(n,{variant:"ghost",size:"sm",onClick:()=>u(!I),className:"h-7 px-2 text-xs",children:[(0,e.jsx)(F,{className:"w-3 h-3 mr-1"}),t.length]}),(0,e.jsx)(n,{variant:"ghost",size:"sm",onClick:()=>f.mutate({workspaceId:l}),className:"h-7 px-2",children:(0,e.jsx)(w,{className:"w-3 h-3"})})]})]}),I&&t&&t.length>0&&(0,e.jsx)("div",{className:"border-b border-gray-200 bg-gray-50 max-h-32 overflow-y-auto",children:(0,e.jsx)("div",{className:"p-2 space-y-1",children:t.map(s=>(0,e.jsx)(n,{variant:r===s.id?"secondary":"ghost",size:"sm",className:"w-full justify-start h-auto p-2 text-left",onClick:()=>{x(s.id),u(!1)},children:(0,e.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,e.jsx)("div",{className:"font-medium text-xs truncate",children:s.title||"New Conversation"}),(0,e.jsx)("div",{className:"text-xs text-gray-500 truncate",children:s.messages[0]?.content||"No messages yet"}),(0,e.jsxs)("div",{className:"flex items-center justify-between mt-1",children:[(0,e.jsxs)("span",{className:"text-xs text-gray-400",children:[s.messages.length," messages"]}),(0,e.jsx)("span",{className:"text-xs text-gray-400",children:M(s.totalCost)})]})]})},s.id))})}),(0,e.jsx)(P,{className:"flex-1 p-3",children:(0,e.jsxs)("div",{className:"space-y-4",children:[r&&g?g.messages.map(s=>(0,e.jsxs)("div",{className:"flex items-start space-x-3",children:[(0,e.jsx)(C,{className:"w-7 h-7 flex-shrink-0",children:(0,e.jsx)(A,{className:"text-xs",children:s.role==="user"?(0,e.jsx)(L,{className:"w-4 h-4"}):(0,e.jsx)(o,{className:"w-4 h-4"})})}),(0,e.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,e.jsxs)("div",{className:"flex items-center space-x-2 mb-1",children:[(0,e.jsx)("span",{className:"font-medium text-xs text-gray-900",children:s.role==="user"?j?.name||"You":"AI"}),(0,e.jsx)("span",{className:"text-xs text-gray-500",children:new Date(s.createdAt).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}),s.role==="assistant"&&(0,e.jsxs)("div",{className:"flex items-center space-x-1 text-xs text-gray-400",children:[(0,e.jsx)(k,{className:"w-3 h-3"}),(0,e.jsx)("span",{children:N(s.tokenCount)}),s.responseTime&&(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(E,{className:"w-3 h-3 ml-1"}),(0,e.jsxs)("span",{children:[s.responseTime,"ms"]})]})]})]}),(0,e.jsx)("div",{className:b("text-sm",s.role==="user"?"bg-krushr-primary/10 p-2 rounded-lg border border-krushr-primary/20":"text-gray-900"),children:(0,e.jsx)("p",{className:"whitespace-pre-wrap",children:s.content})})]})]},s.id)):(0,e.jsxs)("div",{className:"text-center py-8",children:[(0,e.jsx)(o,{className:"w-12 h-12 text-gray-300 mx-auto mb-3"}),(0,e.jsx)("h4",{className:"text-sm font-medium text-gray-900 mb-1",children:"Welcome to AI Assistant"}),(0,e.jsx)("p",{className:"text-xs text-gray-500 mb-4",children:"Ask me anything about your workspace or get help with tasks"}),(0,e.jsxs)(n,{onClick:()=>f.mutate({workspaceId:l}),size:"sm",className:"bg-krushr-primary hover:bg-krushr-primary/90",children:[(0,e.jsx)(w,{className:"w-3 h-3 mr-1"}),"Start Conversation"]})]}),p&&(0,e.jsxs)("div",{className:"flex items-start space-x-3",children:[(0,e.jsx)(C,{className:"w-7 h-7",children:(0,e.jsx)(A,{className:"text-xs",children:(0,e.jsx)(o,{className:"w-4 h-4"})})}),(0,e.jsx)("div",{className:"flex-1",children:(0,e.jsx)("div",{className:"bg-gray-100 p-2 rounded-lg",children:(0,e.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,e.jsx)("div",{className:"animate-spin rounded-full h-3 w-3 border-b-2 border-krushr-primary"}),(0,e.jsx)("span",{className:"text-xs text-gray-500",children:"AI is thinking..."})]})})})]}),(0,e.jsx)("div",{ref:v})]})}),(0,e.jsxs)("div",{className:"p-3 border-t border-gray-200 bg-gray-50/50",children:[(0,e.jsxs)("div",{className:"flex items-center space-x-2 mb-2",children:[(0,e.jsx)("label",{className:"text-xs text-gray-500 flex-shrink-0",children:"Thinking:"}),(0,e.jsx)("input",{type:"range",min:"0",max:"24576",value:c,onChange:s=>D(Number(s.target.value)),className:"flex-1 h-1.5 bg-gray-200 rounded-lg appearance-none cursor-pointer"}),(0,e.jsx)("span",{className:"text-xs text-gray-500 w-12 text-right",children:c===0?"Fast":N(c)})]}),(0,e.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,e.jsx)(W,{ref:Q,placeholder:"Ask AI anything...",value:m,onChange:s=>S(s.target.value),onKeyPress:q,disabled:p,className:"flex-1 h-8 text-sm"}),(0,e.jsx)(n,{onClick:B,disabled:!m.trim()||p,size:"sm",className:"h-8 w-8 p-0",children:(0,e.jsx)(z,{className:"w-3 h-3"})})]})]})]})}export{V as default};
