import{a as u}from"/chunks/chunk-6PMB5CCC.js";import{a as ee}from"/chunks/chunk-VNUY3AR5.js";import{c as g}from"/chunks/chunk-CCWXO4F3.js";import{Aa as U,Ea as X,Qa as $,Ua as Z,b as M,c as _,d as q,f as N,j as V,k as G,ta as J,wa as K}from"/chunks/chunk-PGPPHKG2.js";var n=M(_(),1);var I=M(_(),1),B=768;function te(){let[r,a]=I.useState(void 0);return I.useEffect(()=>{let s=window.matchMedia(`(max-width: ${B-1}px)`),f=()=>{a(window.innerWidth<B)};return s.addEventListener("change",f),a(window.innerWidth<B),()=>s.removeEventListener("change",f)},[]),!!r}var e=M(q(),1),z=[{name:"Yellow",value:"#fef3c7",bgValue:"#fffbeb",border:"#f59e0b"},{name:"Pink",value:"#fce7f3",bgValue:"#fdf2f8",border:"#ec4899"},{name:"Blue",value:"#dbeafe",bgValue:"#eff6ff",border:"#3b82f6"},{name:"Green",value:"#d1fae5",bgValue:"#f0fdf4",border:"#10b981"},{name:"Purple",value:"#e9d5ff",bgValue:"#faf5ff",border:"#8b5cf6"},{name:"Orange",value:"#fed7aa",bgValue:"#fff7ed",border:"#f97316"},{name:"Red",value:"#fecaca",bgValue:"#fef2f2",border:"#ef4444"},{name:"None",value:"#ffffff",bgValue:"#ffffff",border:"#e5e7eb"}],Q=r=>{let a=r.color||r.folder?.color||"#ffffff",s=z.find(f=>f.value.toLowerCase()===a.toLowerCase())||z[7];return console.log("Note color debug:",{noteId:r.id,individualColor:r.color,folderColor:r.folder?.color,finalColor:a,colorConfig:s}),s};function me({note:r,isActive:a,onClick:s,isFirst:f,isLast:k,onArchiveToggle:l}){let o=x=>{let T=new Date(x),h=Math.abs(new Date().getTime()-T.getTime()),d=Math.ceil(h/(1e3*60*60*24));return d===1?"Today":d===2?"Yesterday":d<=7?`${d-1}d ago`:T.toLocaleDateString("en-US",{month:"short",day:"numeric"})},m=Q(r);return(0,e.jsxs)("div",{onClick:s,className:N("border rounded-md p-2 cursor-pointer transition-all duration-200 mb-1",a?"border border-krushr-primary shadow-md":"border border-krushr-gray-200 hover:border-krushr-primary/50 hover:shadow-sm"),style:{backgroundColor:a?"rgba(20, 49, 151, 0.05)":m.bgValue,borderLeftColor:m.border,borderLeftWidth:"3px",borderLeftStyle:"solid"},children:[(0,e.jsxs)("div",{className:"flex items-start justify-between gap-2 mb-3",children:[(0,e.jsx)("h4",{className:N("text-sm font-medium line-clamp-2 flex-1 font-brand",a?"text-krushr-primary":"text-gray-900"),children:r.title||"Untitled"}),(0,e.jsxs)("div",{className:"flex items-center gap-1 flex-shrink-0",children:[r.isPinned&&(0,e.jsx)($,{className:"w-3 h-3 text-amber-500 fill-current"}),r.isArchived&&(0,e.jsx)(V,{className:"w-3 h-3 text-krushr-gray-400"})]})]}),r.content&&(0,e.jsx)("p",{className:"text-sm text-gray-600 mb-3 line-clamp-2 font-manrope",children:r.content}),(0,e.jsxs)("div",{className:"flex items-center justify-between text-xs text-gray-500 font-manrope",children:[(0,e.jsx)("span",{children:o(r.updatedAt)}),(0,e.jsx)("span",{children:new Date(r.updatedAt).toLocaleDateString()})]})]})}function he({value:r,onChange:a,onCreateNote:s,isCreating:f}){return(0,e.jsx)("div",{className:"p-3 border-b border-krushr-gray-200 w-full",children:(0,e.jsxs)("div",{className:"flex items-center gap-2 w-full",children:[(0,e.jsx)(ee,{label:"Search notes",value:r,onChange:k=>a(k.target.value),className:"flex-1 min-w-0 h-8 text-sm font-manrope border border-krushr-gray-300 focus:border-krushr-primary focus:ring-2 focus:ring-krushr-primary/20 transition-all duration-200",type:"search"}),(0,e.jsx)("button",{onClick:s,disabled:f,className:"bg-krushr-primary text-white w-8 h-8 rounded-md flex items-center justify-center hover:bg-krushr-primary/90 transition-all duration-200 disabled:opacity-50 flex-shrink-0",title:"Create new note",children:f?(0,e.jsx)("div",{className:"w-3 h-3 border border-white border-t-transparent rounded-full animate-spin"}):(0,e.jsx)(U,{className:"w-4 h-4"})})]})})}function ge({title:r,onTitleChange:a,onDelete:s,isSaving:f,isDeleting:k,note:l,onPin:o,onColorChange:m,onArchive:x,onExport:T,isSingleColumn:y,onBack:h}){let[d,b]=(0,n.useState)(!1);return(0,e.jsx)("div",{className:"p-3 border-b border-krushr-gray-200 bg-white",children:(0,e.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[y&&h&&(0,e.jsx)("button",{onClick:h,className:"w-6 h-6 flex items-center justify-center text-krushr-gray-600 hover:text-krushr-primary transition-colors flex-shrink-0",type:"button",title:"Back to Notes",children:(0,e.jsx)(G,{className:"w-4 h-4"})}),(0,e.jsxs)("div",{className:"flex-1 relative",children:[(0,e.jsx)("input",{type:"text",value:r,onChange:c=>a(c.target.value),placeholder:"Note title...",className:"w-full h-7 font-medium text-gray-900 font-brand bg-transparent border-0 outline-none placeholder:text-gray-400 focus:bg-krushr-gray-50 rounded px-2 pr-16 transition-colors"}),(0,e.jsx)("div",{className:"absolute right-2 top-1/2 -translate-y-1/2 flex items-center gap-1 text-xs",children:f?(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)("div",{className:"w-1.5 h-1.5 bg-amber-500 rounded-full animate-pulse"}),(0,e.jsx)("span",{className:"text-amber-600 font-medium font-manrope",children:"Saving"})]}):(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)("div",{className:"w-1.5 h-1.5 bg-green-500 rounded-full"}),(0,e.jsx)("span",{className:"text-green-600 font-medium font-manrope",children:"Saved"})]})})]}),(0,e.jsxs)("div",{className:"flex items-center gap-1",children:[l&&(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)("button",{onClick:()=>o(l.id),className:`w-6 h-6 flex items-center justify-center rounded transition-colors ${l.isPinned?"text-amber-500":"text-krushr-gray-400 hover:text-amber-500"}`,title:l.isPinned?"Unpin":"Pin",children:(0,e.jsx)($,{className:`w-3 h-3 ${l.isPinned?"fill-current":""}`})}),(0,e.jsx)("button",{onClick:()=>x?.(l.id),className:`w-6 h-6 flex items-center justify-center rounded transition-colors ${l.isArchived?"text-krushr-primary":"text-krushr-gray-400 hover:text-krushr-primary"}`,title:l.isArchived?"Unarchive":"Archive",children:(0,e.jsx)(V,{className:"w-3 h-3"})}),(0,e.jsxs)("div",{className:"relative",children:[(0,e.jsx)("button",{onClick:()=>b(!d),className:"w-6 h-6 flex items-center justify-center rounded transition-colors text-krushr-gray-400 hover:text-krushr-gray-600",title:"Color",children:(0,e.jsx)(J,{className:"w-3 h-3"})}),d&&(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)("div",{className:"fixed inset-0 z-40",onClick:()=>b(!1)}),(0,e.jsx)("div",{className:"absolute top-full right-0 mt-1 bg-white border border-krushr-gray-200 rounded-lg shadow-xl p-2 z-50",children:(0,e.jsx)("div",{className:"grid grid-cols-4 gap-1",children:z.map(c=>(0,e.jsx)("button",{onClick:()=>{m(l.id,c.value),b(!1)},className:`w-6 h-6 rounded border hover:scale-110 transition-transform ${Q(l).value===c.value?"border-krushr-primary ring-2 ring-krushr-primary/30":"border-krushr-gray-300 hover:border-krushr-primary/50"}`,style:{backgroundColor:c.bgValue},title:c.name},c.value))})})]})]})]}),(0,e.jsx)("button",{onClick:s,disabled:k,className:"w-6 h-6 text-krushr-gray-400 hover:text-red-500 rounded flex items-center justify-center transition-colors disabled:opacity-50",title:"Delete",children:k?(0,e.jsx)("div",{className:"w-3 h-3 border border-red-500 border-t-transparent rounded-full animate-spin"}):(0,e.jsx)(Z,{className:"w-3 h-3"})})]})]})})}var re=n.default.forwardRef(({workspaceId:r,className:a,isFloating:s,onToggleFloating:f,onClose:k},l)=>{let[o,m]=(0,n.useState)(null),[x,T]=(0,n.useState)(""),[y,h]=(0,n.useState)(""),[d,b]=(0,n.useState)(""),[c,oe]=(0,n.useState)(null),[v,ne]=(0,n.useState)(!1),[P,R]=(0,n.useState)(!1),E=(0,n.useRef)(null),j=te(),p=g.notes.list.useQuery({workspaceId:r,search:x||void 0}),w=g.notes.get.useQuery({id:o},{enabled:!!o}),F=g.notes.create.useMutation({onSuccess:t=>{m(t.id),h(t.title),b(t.content||""),p.refetch(),u.success("Note created")}}),O=g.notes.update.useMutation({onSuccess:()=>{p.refetch(),w.refetch()}}),W=g.notes.delete.useMutation({onSuccess:()=>{m(null),h(""),b(""),p.refetch(),u.success("Note deleted")}}),ae=g.notes.togglePin.useMutation({onSuccess:()=>{p.refetch(),w.refetch(),u.success("Note pin status updated")},onError:t=>{u.error("Failed to update pin status")}}),se=g.notes.toggleArchive.useMutation({onSuccess:()=>{p.refetch(),w.refetch(),u.success("Note archive status updated")},onError:t=>{u.error("Failed to update archive status")}}),ie=()=>{try{let t=C.filter(A=>!A.isArchived),i="# Notes Export\\n\\n";t.forEach(A=>{i+=`## ${A.title}\\n\\n`,i+=`${A.content||"No content"}\\n\\n`,i+=`*Updated: ${new Date(A.updatedAt).toLocaleDateString()}*\\n\\n`,i+="---\\n\\n"});let D=new Blob([i],{type:"text/markdown"}),S=URL.createObjectURL(D),L=document.createElement("a");L.href=S,L.download=`notes-export-${new Date().toISOString().split("T")[0]}.md`,document.body.appendChild(L),L.click(),document.body.removeChild(L),URL.revokeObjectURL(S),u.success("Notes exported successfully")}catch{u.error("Failed to export notes")}},be=g.notes.update.useMutation({onSuccess:()=>{p.refetch(),u.success("Note folder updated")},onError:t=>{u.error("Failed to update note folder")}});(0,n.useEffect)(()=>{w.data&&(h(w.data.title),b(w.data.content||""))},[w.data]),(0,n.useEffect)(()=>{let t=()=>{if(E.current){let D=E.current.offsetWidth,S=D<600||j;ne(S),S&&o&&!P&&R(!0),console.log("Notes panel size check:",{width:D,shouldBeSingleColumn:S,isMobile:j,activeNoteId:o,showEditor:P})}};t();let i=new ResizeObserver(t);return E.current&&i.observe(E.current),()=>i.disconnect()},[o,j,P]),(0,n.useEffect)(()=>{if(o&&(y||d)){c&&clearTimeout(c);let t=setTimeout(()=>{O.mutate({id:o,title:y||"Untitled",content:d})},1e3);oe(t)}return()=>{c&&clearTimeout(c)}},[y,d,o]);let H=()=>{F.mutate({title:"New Note",content:"",workspaceId:r,tags:[]})},le=()=>{o&&confirm("Delete this note?")&&W.mutate({id:o})},de=t=>{m(t.id),v&&R(!0)},ce=()=>{R(!1),m(null)},ue=t=>{ae.mutate({id:t})},Y=t=>{se.mutate({id:t})},fe=(t,i)=>{O.mutate({id:t,color:i}),u.success("Note color updated")},C=p.data?.notes||[];return(0,e.jsxs)("div",{ref:E,className:N("flex h-full bg-krushr-gray-50",a),children:[(0,e.jsxs)("div",{className:N("bg-white flex flex-col shadow-sm transition-all duration-300",v?P?"hidden":"w-full":"w-80 border-r border-krushr-gray-200"),children:[s&&(0,e.jsx)(he,{value:x,onChange:T,onCreateNote:H,isCreating:F.isPending}),(0,e.jsx)("div",{className:"flex-1 overflow-y-auto",children:p.isLoading?(0,e.jsx)("div",{className:"flex items-center justify-center py-8",children:(0,e.jsx)("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-krushr-primary"})}):C.length===0?(0,e.jsxs)("div",{className:"p-6 text-center",children:[(0,e.jsx)("div",{className:"w-10 h-10 bg-krushr-gray-100 rounded-full flex items-center justify-center mx-auto mb-2",children:(0,e.jsx)(X,{className:"w-5 h-5 text-krushr-gray-400"})}),(0,e.jsx)("p",{className:"text-gray-900 font-medium font-brand",children:"No notes found"}),(0,e.jsx)("p",{className:"text-gray-400 text-sm mt-1 font-manrope",children:x?"Try different keywords":"Create your first note"})]}):(0,e.jsx)("div",{className:"p-2",children:C.map((t,i)=>(0,e.jsx)(me,{note:t,isActive:o===t.id,onClick:()=>de(t),isFirst:i===0,isLast:i===C.length-1,onArchiveToggle:Y},t.id))})})]}),(0,e.jsx)("div",{className:N("flex flex-col transition-all duration-300",v?P?"w-full":"hidden":"flex-1"),children:o?(0,e.jsxs)(e.Fragment,{children:[s&&(0,e.jsx)(ge,{title:y,onTitleChange:h,onDelete:le,isSaving:O.isPending,isDeleting:W.isPending,note:C.find(t=>t.id===o),onPin:ue,onColorChange:fe,onArchive:Y,onExport:ie,isSingleColumn:v,onBack:ce}),(0,e.jsx)("div",{className:"flex-1",style:{backgroundColor:o?Q(C.find(t=>t.id===o)||{}).bgValue:"#ffffff"},children:(0,e.jsx)("textarea",{value:d,onChange:t=>b(t.target.value),placeholder:"Start writing your note...",className:"w-full h-full resize-none border-0 outline-none text-gray-700 leading-relaxed p-3 text-sm font-manrope placeholder:font-manrope bg-transparent",autoFocus:!0})})]}):(0,e.jsx)("div",{className:"flex-1 flex items-center justify-center",style:{backgroundColor:"#ffffff"},children:(0,e.jsxs)("div",{className:"text-center max-w-md mx-auto p-6",children:[(0,e.jsx)("div",{className:"w-16 h-16 bg-gradient-to-br from-krushr-primary/10 to-krushr-primary/20 rounded-full flex items-center justify-center mx-auto mb-4",children:(0,e.jsx)(K,{className:"w-8 h-8 text-krushr-primary"})}),(0,e.jsx)("h3",{className:N("font-medium text-gray-900 mb-2 font-manrope",v?"text-base":"text-lg"),children:"Select a note to edit"}),(0,e.jsx)("p",{className:N("text-gray-500 leading-relaxed mb-4 font-manrope",v?"text-xs":"text-sm"),children:v?"Tap a note to start editing":"Choose a note from the sidebar to start editing, or create a new note to get started."}),!v&&(0,e.jsx)("button",{onClick:H,disabled:F.isPending,className:"w-8 h-8 bg-krushr-primary text-white rounded-md flex items-center justify-center hover:bg-krushr-primary/90 disabled:opacity-50 transition-colors",title:"Create your first note",children:(0,e.jsx)(U,{className:"w-4 h-4"})})]})})})]})});re.displayName="NotesPanel";var Ce=re;export{Ce as a};
