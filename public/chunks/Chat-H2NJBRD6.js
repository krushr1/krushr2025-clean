import{c as b}from"/chunks/chunk-KE42A34M.js";import{Fa as k,Ia as D,Pa as F,c as l,d as j,e as m,g,gb as B}from"/chunks/chunk-E6NQKUEP.js";var r=l(m(),1),P=({message:e,isOutgoing:t,onReaction:n,onReply:c,showEmojiPicker:a,setShowEmojiPicker:i,quickReactions:d})=>{let x=o=>new Date(o).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"});return(0,r.jsxs)("div",{className:"relative inline-block",children:[(0,r.jsxs)("div",{className:g("rounded-lg p-3 shadow-sm",t?"bg-krushr-primary text-white rounded-tr-none":"bg-gray-100 rounded-tl-none"),children:[(0,r.jsx)("p",{className:g("text-sm",t?"text-white":"text-krushr-gray-dark"),children:e.content}),e.type==="file"&&!t&&(0,r.jsxs)("div",{className:"bg-krushr-gray-bg border border-krushr-gray-200 rounded p-2 flex items-center space-x-2 mt-2",children:[(0,r.jsx)("div",{className:"w-8 h-8 bg-krushr-info rounded flex items-center justify-center",children:(0,r.jsx)("span",{className:"text-white text-xs",children:"File"})}),(0,r.jsxs)("div",{className:"flex-1",children:[(0,r.jsx)("div",{className:"text-sm font-medium",children:"dashboard-mockups.fig"}),(0,r.jsx)("div",{className:"text-xs text-krushr-gray",children:"2.4 MB \u2022 Figma File"})]})]})]}),e.reactions&&e.reactions.length>0&&(0,r.jsx)("div",{className:"absolute -top-2 right-2 flex items-center gap-1",children:e.reactions.map((o,h)=>(0,r.jsxs)("button",{onClick:()=>n(e.id,o.emoji),className:"inline-flex items-center gap-1 px-2 py-1 text-xs bg-white hover:bg-krushr-primary-50 border border-krushr-gray-200 hover:border-krushr-primary-200 rounded-full transition-all duration-200 shadow-sm hover:shadow-md",children:[(0,r.jsx)("span",{className:"text-sm",children:o.emoji}),(0,r.jsx)("span",{className:"font-medium text-krushr-gray",children:o.count})]},h))}),(0,r.jsxs)("div",{className:g("absolute -top-2 opacity-0 group-hover:opacity-100 transition-all duration-200 flex items-center gap-1 bg-white border border-krushr-gray-200 rounded-lg px-2 py-1 shadow-sm","left-2"),children:[!t&&(0,r.jsx)("button",{onClick:()=>c(e),className:"p-1 hover:bg-krushr-primary-50 hover:text-krushr-primary-600 rounded transition-colors duration-200",title:"Reply to message",children:(0,r.jsx)(k,{className:"w-3.5 h-3.5"})}),(0,r.jsxs)("div",{className:"relative",children:[(0,r.jsx)("button",{onClick:()=>i(a===e.id?null:e.id),className:"p-1 hover:bg-krushr-warning-50 hover:text-krushr-warning-600 rounded transition-colors duration-200",title:"Add reaction",children:(0,r.jsx)(F,{className:"w-3.5 h-3.5"})}),a===e.id&&(0,r.jsx)("div",{className:g("absolute bottom-full mb-2 bg-white border border-krushr-gray-200 rounded-lg shadow-lg p-2 flex gap-1 z-50",t?"left-0":"right-0"),children:d.map(o=>(0,r.jsx)("button",{onClick:()=>n(e.id,o),className:"p-1 hover:bg-krushr-gray-100 rounded text-lg leading-none",title:`React with ${o}`,children:o},o))})]})]})]})};var v=l(m(),1),S=({replyTo:e,isOutgoing:t})=>(0,v.jsxs)("div",{className:g("mb-2 border-l-2 border-krushr-primary pl-3 py-2",t?"mr-11 bg-krushr-primary-50 rounded-l-lg ml-16":"ml-11 bg-krushr-gray-bg-light rounded-r-lg"),children:[(0,v.jsxs)("div",{className:"flex items-center gap-1 mb-1",children:[(0,v.jsx)(k,{className:"w-3 h-3 text-krushr-primary"}),(0,v.jsx)("span",{className:"text-xs text-krushr-gray font-medium",children:e.sender})]}),(0,v.jsx)("p",{className:"text-xs text-krushr-gray-light truncate",children:e.content})]});var s=l(m(),1),K=({message:e,currentUserId:t,onReaction:n,onReply:c,showEmojiPicker:a,setShowEmojiPicker:i,quickReactions:d})=>{let x=e.sender.id===t,o=e.type==="system",h=N=>new Date(N).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"});return o?(0,s.jsx)("div",{className:"text-center",children:(0,s.jsx)("div",{className:"bg-krushr-gray-100 text-krushr-gray px-3 py-1 rounded-full text-xs inline-block",children:e.content})}):x?(0,s.jsxs)("div",{className:"group",children:[e.replyTo&&(0,s.jsx)(S,{replyTo:e.replyTo,isOutgoing:!0}),(0,s.jsxs)("div",{className:"flex items-start justify-end space-x-3",children:[(0,s.jsxs)("div",{className:"flex-1 text-right",children:[(0,s.jsx)(P,{message:e,isOutgoing:!0,onReaction:n,onReply:c,showEmojiPicker:a,setShowEmojiPicker:i,quickReactions:d}),(0,s.jsxs)("div",{className:"flex items-center justify-end space-x-2 mt-1",children:[(0,s.jsx)("span",{className:"text-xs text-krushr-gray-light",children:h(e.timestamp)}),(0,s.jsx)("span",{className:"text-xs text-krushr-gray-light",children:"\u2022"}),(0,s.jsx)("span",{className:"text-xs text-krushr-gray-light",children:"Read"})]})]}),(0,s.jsx)("div",{className:"w-8 h-8 bg-krushr-secondary rounded-full flex items-center justify-center text-white text-sm font-medium",children:"ME"})]})]}):(0,s.jsxs)("div",{className:"group",children:[e.replyTo&&(0,s.jsx)(S,{replyTo:e.replyTo,isOutgoing:!1}),(0,s.jsxs)("div",{className:"flex items-start space-x-3",children:[(0,s.jsx)("div",{className:"w-8 h-8 bg-krushr-primary rounded-full flex items-center justify-center text-white text-sm font-medium",children:e.sender.avatar||e.sender.name.slice(0,2).toUpperCase()}),(0,s.jsxs)("div",{className:"flex-1",children:[(0,s.jsx)(P,{message:e,isOutgoing:!1,onReaction:n,onReply:c,showEmojiPicker:a,setShowEmojiPicker:i,quickReactions:d}),(0,s.jsxs)("div",{className:"flex items-center space-x-2 mt-1",children:[(0,s.jsx)("span",{className:"text-xs text-krushr-gray-light",children:e.sender.name}),(0,s.jsx)("span",{className:"text-xs text-krushr-gray-light",children:"\u2022"}),(0,s.jsx)("span",{className:"text-xs text-krushr-gray-light",children:h(e.timestamp)})]})]})]})]})};var u=l(m(),1),A=({replyingTo:e,onCancel:t})=>(0,u.jsxs)("div",{className:"flex-shrink-0 px-4 py-2 bg-krushr-info-50 border-t border-krushr-info-200",children:[(0,u.jsxs)("div",{className:"flex items-center justify-between",children:[(0,u.jsxs)("div",{className:"flex items-center gap-2",children:[(0,u.jsx)(k,{className:"w-3 h-3 text-krushr-info-600"}),(0,u.jsxs)("span",{className:"text-sm text-krushr-info-700 font-medium",children:["Replying to ",e.sender.name]})]}),(0,u.jsx)("button",{onClick:t,className:"p-1 text-krushr-info-600 hover:text-krushr-info-800 hover:bg-krushr-info-100 rounded transition-colors duration-200",title:"Cancel reply",children:(0,u.jsx)(B,{className:"w-3 h-3"})})]}),(0,u.jsx)("p",{className:"text-xs text-krushr-info-600 mt-1 truncate pl-5",children:e.content})]});var f=l(m(),1),H=({message:e,onChange:t,onSend:n,onKeyPress:c,inputRef:a})=>(0,f.jsxs)("div",{className:"flex-shrink-0 flex items-center space-x-3 p-4 pt-3 border-t border-krushr-gray-200",children:[(0,f.jsxs)("div",{className:"relative flex-1",children:[(0,f.jsx)("input",{ref:a,type:"text",id:"floating_chat",className:"block px-4 pb-2 pt-3 w-full text-sm text-krushr-gray-900 bg-white rounded-lg border border-krushr-gray-200 appearance-none focus:outline-none focus:ring-2 focus:ring-krushr-primary focus:border-transparent peer font-manrope transition-all duration-200",placeholder:" ",value:e,onChange:i=>t(i.target.value),onKeyPress:c}),(0,f.jsx)("label",{htmlFor:"floating_chat",className:"absolute text-sm text-krushr-gray-500 duration-300 transform -translate-y-4 scale-75 top-2 z-10 origin-[0] bg-white px-2 peer-focus:px-2 peer-focus:text-krushr-primary peer-placeholder-shown:scale-100 peer-placeholder-shown:-translate-y-1/2 peer-placeholder-shown:top-1/2 peer-focus:top-2 peer-focus:scale-75 peer-focus:-translate-y-4 left-5 font-manrope",children:"Type a message..."})]}),(0,f.jsx)("button",{onClick:n,disabled:!e.trim(),className:"bg-krushr-primary text-white w-10 h-10 rounded-lg flex items-center justify-center hover:bg-krushr-primary-700 transition-all duration-200 shadow-sm hover:shadow-md disabled:opacity-50 disabled:cursor-not-allowed font-medium",title:"Send message",children:(0,f.jsx)(D,{className:"w-4 h-4"})})]});var C=l(j(),1);var O=[{id:"1",content:"Hey team, how's the progress on the dashboard redesign?",type:"text",sender:{id:"1",name:"John Doe",avatar:"JD"},timestamp:new Date(Date.now()-10*60*1e3).toISOString(),reactions:[{emoji:"\u{1F44D}",count:2,users:["2","3"]}]},{id:"2",content:"We're about 70% done! Should be ready for review by Friday.",type:"text",sender:{id:"2",name:"You",avatar:"ME"},timestamp:new Date(Date.now()-8*60*1e3).toISOString(),replyTo:{id:"1",content:"Hey team, how's the progress...",sender:"John Doe"}},{id:"3",content:"Alice joined the conversation",type:"system",sender:{id:"system",name:"System",avatar:""},timestamp:new Date(Date.now()-6*60*1e3).toISOString()},{id:"4",content:"Here are the latest mockups for review:",type:"file",sender:{id:"3",name:"Alice Smith",avatar:"AS"},timestamp:new Date(Date.now()-4*60*1e3).toISOString(),reactions:[{emoji:"\u{1F680}",count:1,users:["2"]},{emoji:"\u{1F4AF}",count:1,users:["1"]}]}],q=["\u{1F44D}","\u2764\uFE0F","\u{1F60A}","\u{1F680}","\u{1F4AF}","\u{1F44F}"];var L=e=>{let t=(0,C.useRef)(null),{data:n}=b.chat.getMessages.useQuery({threadId:e||"default"},{enabled:!!e}),c=n?.messages||[],a=e?c:O;return(0,C.useEffect)(()=>{let i=t.current?.closest("[data-radix-scroll-area-viewport]");i&&t.current&&(i.scrollTop=i.scrollHeight)},[a]),{messages:a,messagesEndRef:t}};var w=l(j(),1);var U=e=>{let[t,n]=(0,w.useState)(""),[c,a]=(0,w.useState)(null),[i,d]=(0,w.useState)(null),x=(0,w.useRef)(null),o=b.chat.sendMessage.useMutation({}),h=b.chat.addReaction.useMutation({}),N=b.chat.removeReaction.useMutation({}),M=()=>{t.trim()&&(e&&o.mutate({threadId:e,content:t,type:"TEXT",replyToId:c?.id}),n(""),a(null))};return{message:t,setMessage:n,replyingTo:c,setReplyingTo:a,showEmojiPicker:i,setShowEmojiPicker:d,messageInputRef:x,handleSendMessage:M,handleReaction:(p,R)=>{e?h.mutate({messageId:p,emoji:R}):console.log(`Adding reaction ${R} to message ${p}`),d(null)},handleReply:p=>{a(p),x.current?.focus()},handleKeyPress:p=>{p.key==="Enter"&&!p.shiftKey&&(p.preventDefault(),M())}}};var y=l(m(),1);function J({threadId:e,className:t}){let{messages:n,messagesEndRef:c}=L(e),{message:a,setMessage:i,replyingTo:d,setReplyingTo:x,showEmojiPicker:o,setShowEmojiPicker:h,messageInputRef:N,handleSendMessage:M,handleReaction:T,handleReply:E,handleKeyPress:I}=U(e),p="2";return(0,y.jsxs)("div",{className:g("bg-white h-full flex flex-col",t),children:[(0,y.jsxs)("div",{className:"flex-1 space-y-4 p-4 pb-0 overflow-y-auto",children:[n.map(R=>(0,y.jsx)(K,{message:R,currentUserId:p,onReaction:T,onReply:E,showEmojiPicker:o,setShowEmojiPicker:h,quickReactions:q},R.id)),(0,y.jsx)("div",{ref:c})]}),d&&(0,y.jsx)(A,{replyingTo:d,onCancel:()=>x(null)}),(0,y.jsx)(H,{message:a,onChange:i,onSend:M,onKeyPress:I,inputRef:N})]})}export{J as default};
