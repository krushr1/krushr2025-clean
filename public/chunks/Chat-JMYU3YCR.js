import{d as b}from"/chunks/chunk-RAYIPUBU.js";import{Db as F,Xa as k,_a as D,c as l,d as j,e as c,fb as B,g as d}from"/chunks/chunk-XLF7ZOXQ.js";var r=l(c(),1),P=({message:e,isOutgoing:t,onReaction:n,onReply:m,showEmojiPicker:a,setShowEmojiPicker:i,quickReactions:p})=>{let x=o=>new Date(o).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"});return(0,r.jsxs)("div",{className:"relative inline-block",children:[(0,r.jsxs)("div",{className:d("rounded-lg p-3 shadow-sm",t?"bg-krushr-primary text-white rounded-tr-none":"bg-gray-100 rounded-tl-none"),children:[(0,r.jsx)("p",{className:d("text-sm",t?"text-white":"text-krushr-gray-dark"),children:e.content}),e.type==="file"&&!t&&(0,r.jsxs)("div",{className:"bg-krushr-gray-bg border border-krushr-gray-200 rounded p-2 flex items-center space-x-2 mt-2",children:[(0,r.jsx)("div",{className:"w-8 h-8 bg-krushr-info rounded flex items-center justify-center",children:(0,r.jsx)("span",{className:"text-white text-xs",children:"File"})}),(0,r.jsxs)("div",{className:"flex-1",children:[(0,r.jsx)("div",{className:"text-sm font-medium",children:"dashboard-mockups.fig"}),(0,r.jsx)("div",{className:"text-xs text-krushr-gray",children:"2.4 MB \u2022 Figma File"})]})]})]}),e.reactions&&e.reactions.length>0&&(0,r.jsx)("div",{className:"absolute -top-2 right-2 flex items-center gap-1",children:e.reactions.map((o,f)=>(0,r.jsxs)("button",{onClick:()=>n(e.id,o.emoji),className:"inline-flex items-center gap-1 px-2 py-1 text-xs bg-white hover:bg-krushr-primary-50 border border-krushr-gray-200 hover:border-krushr-primary-200 rounded-full transition-all duration-200 shadow-sm hover:shadow-md",children:[(0,r.jsx)("span",{className:"text-sm",children:o.emoji}),(0,r.jsx)("span",{className:"font-medium text-krushr-gray",children:o.count})]},f))}),(0,r.jsxs)("div",{className:d("absolute -top-2 opacity-0 group-hover:opacity-100 transition-all duration-200 flex items-center gap-1 bg-white border border-krushr-gray-200 rounded-lg px-2 py-1 shadow-sm","left-2"),children:[!t&&(0,r.jsx)("button",{onClick:()=>m(e),className:"p-1 hover:bg-krushr-primary-50 hover:text-krushr-primary-600 rounded transition-colors duration-200",title:"Reply to message",children:(0,r.jsx)(k,{className:"w-3.5 h-3.5"})}),(0,r.jsxs)("div",{className:"relative",children:[(0,r.jsx)("button",{onClick:()=>i(a===e.id?null:e.id),className:"p-1 hover:bg-krushr-warning-50 hover:text-krushr-warning-600 rounded transition-colors duration-200",title:"Add reaction",children:(0,r.jsx)(B,{className:"w-3.5 h-3.5"})}),a===e.id&&(0,r.jsx)("div",{className:d("absolute bottom-full mb-2 bg-white border border-krushr-gray-200 rounded-lg shadow-lg p-2 flex gap-1 z-50",t?"left-0":"right-0"),children:p.map(o=>(0,r.jsx)("button",{onClick:()=>n(e.id,o),className:"p-1 hover:bg-krushr-gray-100 rounded text-lg leading-none",title:`React with ${o}`,children:o},o))})]})]})]})};var v=l(c(),1),S=({replyTo:e,isOutgoing:t})=>(0,v.jsxs)("div",{className:d("mb-2 border-l-2 border-krushr-primary pl-3 py-2",t?"mr-11 bg-krushr-primary-50 rounded-l-lg ml-16":"ml-11 bg-krushr-gray-bg-light rounded-r-lg"),children:[(0,v.jsxs)("div",{className:"flex items-center gap-1 mb-1",children:[(0,v.jsx)(k,{className:"w-3 h-3 text-krushr-primary"}),(0,v.jsx)("span",{className:"text-xs text-krushr-gray font-medium",children:e.sender})]}),(0,v.jsx)("p",{className:"text-xs text-krushr-gray-light truncate",children:e.content})]});var s=l(c(),1),K=({message:e,currentUserId:t,onReaction:n,onReply:m,showEmojiPicker:a,setShowEmojiPicker:i,quickReactions:p})=>{let x=e.sender.id===t,o=e.type==="system",f=N=>new Date(N).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"});return o?(0,s.jsx)("div",{className:"text-center",children:(0,s.jsx)("div",{className:"bg-krushr-gray-100 text-krushr-gray px-3 py-1 rounded-full text-xs inline-block",children:e.content})}):x?(0,s.jsxs)("div",{className:"group",children:[e.replyTo&&(0,s.jsx)(S,{replyTo:e.replyTo,isOutgoing:!0}),(0,s.jsxs)("div",{className:"flex items-start justify-end space-x-3",children:[(0,s.jsxs)("div",{className:"flex-1 text-right",children:[(0,s.jsx)(P,{message:e,isOutgoing:!0,onReaction:n,onReply:m,showEmojiPicker:a,setShowEmojiPicker:i,quickReactions:p}),(0,s.jsxs)("div",{className:"flex items-center justify-end space-x-2 mt-1",children:[(0,s.jsx)("span",{className:"text-xs text-krushr-gray-light",children:f(e.timestamp)}),(0,s.jsx)("span",{className:"text-xs text-krushr-gray-light",children:"\u2022"}),(0,s.jsx)("span",{className:"text-xs text-krushr-gray-light",children:"Read"})]})]}),(0,s.jsx)("div",{className:"w-8 h-8 bg-krushr-secondary rounded-full flex items-center justify-center text-white text-sm font-medium",children:"ME"})]})]}):(0,s.jsxs)("div",{className:"group",children:[e.replyTo&&(0,s.jsx)(S,{replyTo:e.replyTo,isOutgoing:!1}),(0,s.jsxs)("div",{className:"flex items-start space-x-3",children:[(0,s.jsx)("div",{className:"w-8 h-8 bg-krushr-primary rounded-full flex items-center justify-center text-white text-sm font-medium",children:e.sender.avatar||e.sender.name.slice(0,2).toUpperCase()}),(0,s.jsxs)("div",{className:"flex-1",children:[(0,s.jsx)(P,{message:e,isOutgoing:!1,onReaction:n,onReply:m,showEmojiPicker:a,setShowEmojiPicker:i,quickReactions:p}),(0,s.jsxs)("div",{className:"flex items-center space-x-2 mt-1",children:[(0,s.jsx)("span",{className:"text-xs text-krushr-gray-light",children:e.sender.name}),(0,s.jsx)("span",{className:"text-xs text-krushr-gray-light",children:"\u2022"}),(0,s.jsx)("span",{className:"text-xs text-krushr-gray-light",children:f(e.timestamp)})]})]})]})]})};var h=l(c(),1),A=({replyingTo:e,onCancel:t})=>(0,h.jsxs)("div",{className:"flex-shrink-0 px-4 py-2 bg-krushr-info-50 border-t border-krushr-info-200",children:[(0,h.jsxs)("div",{className:"flex items-center justify-between",children:[(0,h.jsxs)("div",{className:"flex items-center gap-2",children:[(0,h.jsx)(k,{className:"w-3 h-3 text-krushr-info-600"}),(0,h.jsxs)("span",{className:"text-sm text-krushr-info-700 font-medium",children:["Replying to ",e.sender.name]})]}),(0,h.jsx)("button",{onClick:t,className:"p-1 text-krushr-info-600 hover:text-krushr-info-800 hover:bg-krushr-info-100 rounded transition-colors duration-200",title:"Cancel reply",children:(0,h.jsx)(F,{className:"w-3 h-3"})})]}),(0,h.jsx)("p",{className:"text-xs text-krushr-info-600 mt-1 truncate pl-5",children:e.content})]});var g=l(c(),1),H=({message:e,onChange:t,onSend:n,onKeyPress:m,inputRef:a})=>(0,g.jsx)("div",{className:"flex-shrink-0 p-4 pt-3 border-t border-krushr-gray-200",children:(0,g.jsxs)("div",{className:"relative flex items-center bg-white border border-gray-300 rounded-3xl shadow-sm hover:shadow-md transition-shadow focus-within:shadow-md focus-within:border-krushr-primary h-[60px]",children:[(0,g.jsxs)("div",{className:"flex-1 min-w-0 relative",children:[(0,g.jsx)("input",{ref:a,type:"text",value:e,onChange:i=>t(i.target.value),onKeyPress:m,placeholder:"",className:"w-full min-h-[46px] h-[46px] text-sm resize-none border-0 bg-transparent focus:ring-0 focus:outline-none px-3 py-3 placeholder-transparent peer leading-relaxed font-manrope"}),(0,g.jsx)("label",{className:d("absolute left-3 text-gray-500 duration-300 transform origin-[0] bg-white px-1 pointer-events-none select-none z-10",e.trim()?"-top-2 text-xs scale-75 text-krushr-primary":"top-1/2 -translate-y-1/2 text-sm peer-focus:-top-2 peer-focus:text-xs peer-focus:scale-75 peer-focus:text-krushr-primary"),children:"Type a message..."})]}),(0,g.jsx)("div",{className:"flex items-center pr-3",children:(0,g.jsx)("button",{onClick:n,disabled:!e.trim(),className:"h-8 w-8 rounded-full flex items-center justify-center transition-all p-0 bg-krushr-primary text-white hover:bg-krushr-primary/90 shadow-sm hover:shadow disabled:opacity-50 disabled:cursor-not-allowed",title:"Send message",children:(0,g.jsx)(D,{className:"w-4 h-4"})})})]})});var C=l(j(),1);var O=[{id:"1",content:"Hey team, how's the progress on the dashboard redesign?",type:"text",sender:{id:"1",name:"John Doe",avatar:"JD"},timestamp:new Date(Date.now()-10*60*1e3).toISOString(),reactions:[{emoji:"\u{1F44D}",count:2,users:["2","3"]}]},{id:"2",content:"We're about 70% done! Should be ready for review by Friday.",type:"text",sender:{id:"2",name:"You",avatar:"ME"},timestamp:new Date(Date.now()-8*60*1e3).toISOString(),replyTo:{id:"1",content:"Hey team, how's the progress...",sender:"John Doe"}},{id:"3",content:"Alice joined the conversation",type:"system",sender:{id:"system",name:"System",avatar:""},timestamp:new Date(Date.now()-6*60*1e3).toISOString()},{id:"4",content:"Here are the latest mockups for review:",type:"file",sender:{id:"3",name:"Alice Smith",avatar:"AS"},timestamp:new Date(Date.now()-4*60*1e3).toISOString(),reactions:[{emoji:"\u{1F680}",count:1,users:["2"]},{emoji:"\u{1F4AF}",count:1,users:["1"]}]}],q=["\u{1F44D}","\u2764\uFE0F","\u{1F60A}","\u{1F680}","\u{1F4AF}","\u{1F44F}"];var L=e=>{let t=(0,C.useRef)(null),{data:n}=b.chat.getMessages.useQuery({threadId:e||"default"},{enabled:!!e}),m=n?.messages||[],a=e?m:O;return(0,C.useEffect)(()=>{let i=t.current?.closest("[data-radix-scroll-area-viewport]");i&&t.current&&(i.scrollTop=i.scrollHeight)},[a]),{messages:a,messagesEndRef:t}};var w=l(j(),1);var U=e=>{let[t,n]=(0,w.useState)(""),[m,a]=(0,w.useState)(null),[i,p]=(0,w.useState)(null),x=(0,w.useRef)(null),o=b.chat.sendMessage.useMutation({}),f=b.chat.addReaction.useMutation({}),N=b.chat.removeReaction.useMutation({}),M=()=>{t.trim()&&(e&&o.mutate({threadId:e,content:t,type:"TEXT",replyToId:m?.id}),n(""),a(null))};return{message:t,setMessage:n,replyingTo:m,setReplyingTo:a,showEmojiPicker:i,setShowEmojiPicker:p,messageInputRef:x,handleSendMessage:M,handleReaction:(u,R)=>{e?f.mutate({messageId:u,emoji:R}):console.log(`Adding reaction ${R} to message ${u}`),p(null)},handleReply:u=>{a(u),x.current?.focus()},handleKeyPress:u=>{u.key==="Enter"&&!u.shiftKey&&(u.preventDefault(),M())}}};var y=l(c(),1);function z({threadId:e,className:t}){let{messages:n,messagesEndRef:m}=L(e),{message:a,setMessage:i,replyingTo:p,setReplyingTo:x,showEmojiPicker:o,setShowEmojiPicker:f,messageInputRef:N,handleSendMessage:M,handleReaction:T,handleReply:E,handleKeyPress:I}=U(e),u="2";return(0,y.jsxs)("div",{className:d("bg-white h-full flex flex-col",t),children:[(0,y.jsxs)("div",{className:"flex-1 space-y-4 p-4 pb-0 overflow-y-auto",children:[n.map(R=>(0,y.jsx)(K,{message:R,currentUserId:u,onReaction:T,onReply:E,showEmojiPicker:o,setShowEmojiPicker:f,quickReactions:q},R.id)),(0,y.jsx)("div",{ref:m})]}),p&&(0,y.jsx)(A,{replyingTo:p,onCancel:()=>x(null)}),(0,y.jsx)(H,{message:a,onChange:i,onSend:M,onKeyPress:I,inputRef:N})]})}export{z as default};
