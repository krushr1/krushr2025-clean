import{a as f}from"/chunks/chunk-QBROC7HK.js";import{a as te}from"/chunks/chunk-WGRBIA4T.js";import{g as re}from"/chunks/chunk-OCDNZNMT.js";import{c as v}from"/chunks/chunk-4BKYIWEF.js";import{Ja as K,Ma as X,Qa as $,Wa as Z,c as D,d as q,e as G,fb as B,g as N,k as V,l as J,lb as ee}from"/chunks/chunk-DMBWTQIB.js";var s=D(q(),1);var I=D(q(),1),F=768;function oe(){let[o,i]=I.useState(void 0);return I.useEffect(()=>{let d=window.matchMedia(`(max-width: ${F-1}px)`),r=()=>{i(window.innerWidth<F)};return d.addEventListener("change",r),i(window.innerWidth<F),()=>d.removeEventListener("change",r)},[]),!!o}var e=D(G(),1),z=[{name:"Yellow",value:"#fef3c7",bgValue:"#fffbeb",border:"#f59e0b"},{name:"Pink",value:"#fce7f3",bgValue:"#fdf2f8",border:"#ec4899"},{name:"Blue",value:"#dbeafe",bgValue:"#eff6ff",border:"#3b82f6"},{name:"Green",value:"#d1fae5",bgValue:"#f0fdf4",border:"#10b981"},{name:"Purple",value:"#e9d5ff",bgValue:"#faf5ff",border:"#8b5cf6"},{name:"Orange",value:"#fed7aa",bgValue:"#fff7ed",border:"#f97316"},{name:"Red",value:"#fecaca",bgValue:"#fef2f2",border:"#ef4444"},{name:"None",value:"#ffffff",bgValue:"#ffffff",border:"#e5e7eb"}],Q=o=>{let i=o.color||o.folder?.color||"#ffffff",d=z.find(r=>r.value.toLowerCase()===i.toLowerCase())||z[7];return console.log("Note color debug:",{noteId:o.id,individualColor:o.color,folderColor:o.folder?.color,finalColor:i,colorConfig:d}),d};function he({note:o,isActive:i,onClick:d,isFirst:r,isLast:c,onArchiveToggle:a}){let T=x=>{let y=new Date(x),g=Math.abs(new Date().getTime()-y.getTime()),b=Math.ceil(g/(1e3*60*60*24));return b===1?"Today":b===2?"Yesterday":b<=7?`${b-1}d ago`:y.toLocaleDateString("en-US",{month:"short",day:"numeric"})},h=Q(o);return(0,e.jsxs)("div",{onClick:d,className:N("border rounded-md p-2 cursor-pointer transition-all duration-200 mb-1",i?"border border-krushr-primary shadow-md":"border border-krushr-gray-200 hover:border-krushr-primary/50 hover:shadow-sm"),style:{backgroundColor:i?"rgba(20, 49, 151, 0.05)":h.bgValue,borderLeftColor:h.border,borderLeftWidth:"3px",borderLeftStyle:"solid"},children:[(0,e.jsxs)("div",{className:"flex items-start justify-between gap-2 mb-3",children:[(0,e.jsx)("h4",{className:N("font-medium line-clamp-2 flex-1 font-brand",i?"text-krushr-primary":"text-gray-900"),children:o.title||"Untitled"}),(0,e.jsxs)("div",{className:"flex items-center gap-1 flex-shrink-0",children:[o.isPinned&&(0,e.jsx)(B,{className:"w-3 h-3 text-amber-500 fill-current"}),o.isArchived&&(0,e.jsx)(V,{className:"w-3 h-3 text-krushr-gray-400"})]})]}),o.content&&(0,e.jsx)("p",{className:"text-sm text-gray-600 mb-3 line-clamp-2 font-manrope",children:o.content}),(0,e.jsxs)("div",{className:"flex items-center justify-between text-xs text-gray-500 font-manrope",children:[(0,e.jsx)("span",{children:T(o.updatedAt)}),(0,e.jsx)("span",{children:new Date(o.updatedAt).toLocaleDateString()})]})]})}function ge({value:o,onChange:i,onCreateNote:d,isCreating:r}){return(0,e.jsx)("div",{className:"p-3 border-b border-krushr-gray-200 w-full",children:(0,e.jsxs)("div",{className:"flex items-center gap-2 w-full",children:[(0,e.jsx)(te,{label:"Search notes",value:o,onChange:c=>i(c.target.value),className:"flex-1 min-w-0 h-8 text-sm font-manrope border border-krushr-gray-300 focus:border-krushr-primary focus:ring-2 focus:ring-krushr-primary/20 transition-all duration-200",type:"search"}),(0,e.jsx)("button",{onClick:d,disabled:r,className:"bg-krushr-primary text-white w-8 h-8 rounded-md flex items-center justify-center hover:bg-krushr-primary/90 transition-all duration-200 disabled:opacity-50 flex-shrink-0",title:"Create new note",children:r?(0,e.jsx)("div",{className:"w-3 h-3 border border-white border-t-transparent rounded-full animate-spin"}):(0,e.jsx)($,{className:"w-4 h-4"})})]})})}function be({title:o,onTitleChange:i,onDelete:d,isSaving:r,isDeleting:c,note:a,onPin:T,onColorChange:h,onArchive:x,onExport:y,isSingleColumn:w,onBack:g}){let[b,u]=(0,s.useState)(!1);return(0,e.jsx)("div",{className:"p-3 border-b border-krushr-gray-200 bg-white",children:(0,e.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[w&&g&&(0,e.jsx)("button",{onClick:g,className:"w-6 h-6 flex items-center justify-center text-krushr-gray-600 hover:text-krushr-primary transition-colors flex-shrink-0",type:"button",title:"Back to Notes",children:(0,e.jsx)(J,{className:"w-4 h-4"})}),(0,e.jsxs)("div",{className:"flex-1 relative",children:[(0,e.jsx)("input",{type:"text",value:o,onChange:p=>i(p.target.value),placeholder:"Note title...",className:"w-full h-7 font-medium text-gray-900 font-brand bg-transparent border-0 outline-none placeholder:text-gray-400 focus:bg-krushr-gray-50 rounded px-2 pr-16 transition-colors"}),(0,e.jsx)("div",{className:"absolute right-2 top-1/2 -translate-y-1/2 flex items-center gap-1 text-xs",children:r?(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)("div",{className:"w-1.5 h-1.5 bg-amber-500 rounded-full animate-pulse"}),(0,e.jsx)("span",{className:"text-amber-600 font-medium font-manrope",children:"Saving"})]}):(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)("div",{className:"w-1.5 h-1.5 bg-green-500 rounded-full"}),(0,e.jsx)("span",{className:"text-green-600 font-medium font-manrope",children:"Saved"})]})})]}),(0,e.jsxs)("div",{className:"flex items-center gap-1",children:[a&&(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)("button",{onClick:()=>T(a.id),className:`w-6 h-6 flex items-center justify-center rounded transition-colors ${a.isPinned?"text-amber-500":"text-krushr-gray-400 hover:text-amber-500"}`,title:a.isPinned?"Unpin":"Pin",children:(0,e.jsx)(B,{className:`w-3 h-3 ${a.isPinned?"fill-current":""}`})}),(0,e.jsx)("button",{onClick:()=>x?.(a.id),className:`w-6 h-6 flex items-center justify-center rounded transition-colors ${a.isArchived?"text-krushr-primary":"text-krushr-gray-400 hover:text-krushr-primary"}`,title:a.isArchived?"Unarchive":"Archive",children:(0,e.jsx)(V,{className:"w-3 h-3"})}),(0,e.jsxs)("div",{className:"relative",children:[(0,e.jsx)("button",{onClick:()=>u(!b),className:"w-6 h-6 flex items-center justify-center rounded transition-colors text-krushr-gray-400 hover:text-krushr-gray-600",title:"Color",children:(0,e.jsx)(K,{className:"w-3 h-3"})}),b&&(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)("div",{className:"fixed inset-0 z-40",onClick:()=>u(!1)}),(0,e.jsx)("div",{className:"absolute top-full right-0 mt-1 bg-white border border-krushr-gray-200 rounded-lg shadow-xl p-2 z-50",children:(0,e.jsx)("div",{style:{display:"grid",gridTemplateColumns:"repeat(4, 1fr)",gap:"4px"},children:z.map(p=>(0,e.jsx)("button",{onClick:()=>{h(a.id,p.value),u(!1)},className:`w-6 h-6 rounded border hover:scale-110 transition-transform ${Q(a).value===p.value?"border-krushr-primary ring-2 ring-krushr-primary/30":"border-krushr-gray-300 hover:border-krushr-primary/50"}`,style:{backgroundColor:p.bgValue},title:p.name},p.value))})})]})]})]}),(0,e.jsx)("button",{onClick:d,disabled:c,className:"w-6 h-6 text-krushr-gray-400 hover:text-red-500 rounded flex items-center justify-center transition-colors disabled:opacity-50",title:"Delete",children:c?(0,e.jsx)("div",{className:"w-3 h-3 border border-red-500 border-t-transparent rounded-full animate-spin"}):(0,e.jsx)(ee,{className:"w-3 h-3"})})]})]})})}var ne=s.default.forwardRef(({workspaceId:o,className:i},d)=>{let[r,c]=(0,s.useState)(null),[a,T]=(0,s.useState)(""),[h,x]=(0,s.useState)(""),[y,w]=(0,s.useState)(""),[g,b]=(0,s.useState)(null),[u,p]=(0,s.useState)(!1),[L,M]=(0,s.useState)(!1),[H,R]=(0,s.useState)(new Set),P=(0,s.useRef)(null),j=oe(),m=v.notes.list.useQuery({workspaceId:o,search:a||void 0}),k=v.notes.get.useQuery({id:r},{enabled:!!r}),O=v.notes.create.useMutation({onSuccess:t=>{c(t.id),x(t.title),w(t.content||""),m.refetch(),f.success("Note created")}}),U=v.notes.update.useMutation({onSuccess:()=>{m.refetch(),k.refetch()}}),W=v.notes.delete.useMutation({onSuccess:()=>{c(null),x(""),w(""),m.refetch(),f.success("Note deleted")}}),ae=v.notes.togglePin.useMutation({onSuccess:()=>{m.refetch(),k.refetch(),f.success("Note pin status updated")},onError:t=>{f.error("Failed to update pin status")}}),se=v.notes.toggleArchive.useMutation({onSuccess:()=>{m.refetch(),k.refetch(),f.success("Note archive status updated")},onError:t=>{f.error("Failed to update archive status")}}),ie=()=>{try{let t=C.filter(E=>!E.isArchived),n="# Notes Export\\n\\n";t.forEach(E=>{n+=`## ${E.title}\\n\\n`,n+=`${E.content||"No content"}\\n\\n`,n+=`*Updated: ${new Date(E.updatedAt).toLocaleDateString()}*\\n\\n`,n+="---\\n\\n"});let l=new Blob([n],{type:"text/markdown"}),S=URL.createObjectURL(l),A=document.createElement("a");A.href=S,A.download=`notes-export-${new Date().toISOString().split("T")[0]}.md`,document.body.appendChild(A),A.click(),document.body.removeChild(A),URL.revokeObjectURL(S),f.success("Notes exported successfully")}catch{f.error("Failed to export notes")}},pe=v.notes.update.useMutation({onSuccess:()=>{m.refetch(),f.success("Note folder updated")},onError:t=>{f.error("Failed to update note folder")}});(0,s.useEffect)(()=>{k.data&&(x(k.data.title),w(k.data.content||""))},[k.data]),(0,s.useEffect)(()=>{let t=()=>{if(P.current){let l=P.current.offsetWidth,S=l<600||j;p(S),S&&r&&!L&&M(!0),console.log("Notes panel size check:",{width:l,shouldBeSingleColumn:S,isMobile:j,activeNoteId:r,showEditor:L})}};t();let n=new ResizeObserver(t);return P.current&&n.observe(P.current),()=>n.disconnect()},[r,j,L]),(0,s.useEffect)(()=>{if(r&&(h||y)){g&&clearTimeout(g);let t=setTimeout(()=>{U.mutate({id:r,title:h||"Untitled",content:y})},1e3);b(t)}return()=>{g&&clearTimeout(g)}},[h,y,r]);let Y=()=>{O.mutate({title:"New Note",content:"",workspaceId:o,tags:[]})},{deleteItem:le}=re(),de=async()=>{if(!r)return;let t=m.data?.notes?.find(n=>n.id===r);t&&await le({type:"note",item:t,itemName:t.title||"Untitled note",deleteAction:async()=>{await W.mutateAsync({id:r}),R(n=>{let l=new Set(n);return l.delete(r),l})},onOptimisticRemove:()=>{R(l=>new Set(l).add(r));let n=m.data?.notes?.filter(l=>l.id!==r&&!H.has(l.id));c(n?.[0]?.id||null)},onRestore:()=>{R(n=>{let l=new Set(n);return l.delete(t.id),l}),c(t.id)}})},ce=t=>{c(t.id),u&&M(!0)},ue=()=>{M(!1),c(null)},fe=t=>{ae.mutate({id:t})},_=t=>{se.mutate({id:t})},me=(t,n)=>{U.mutate({id:t,color:n}),f.success("Note color updated")},C=(m.data?.notes||[]).filter(t=>!H.has(t.id)&&(a?t.title.toLowerCase().includes(a.toLowerCase())||t.content?.toLowerCase().includes(a.toLowerCase()):!0));return(0,e.jsxs)("div",{ref:P,className:N("flex h-full bg-krushr-gray-50",i),children:[(0,e.jsxs)("div",{className:N("bg-white flex flex-col shadow-sm transition-all duration-300",u?L?"hidden":"w-full":"w-80 border-r border-krushr-gray-200"),children:[(0,e.jsx)(ge,{value:a,onChange:T,onCreateNote:Y,isCreating:O.isPending}),(0,e.jsx)("div",{className:"flex-1 overflow-y-auto",children:m.isLoading?(0,e.jsx)("div",{className:"flex items-center justify-center py-8",children:(0,e.jsx)("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-krushr-primary"})}):C.length===0?(0,e.jsxs)("div",{className:"p-6 text-center",children:[(0,e.jsx)("div",{className:"w-10 h-10 bg-krushr-gray-100 rounded-full flex items-center justify-center mx-auto mb-2",children:(0,e.jsx)(Z,{className:"w-5 h-5 text-krushr-gray-400"})}),(0,e.jsx)("p",{className:"text-gray-900 font-medium font-brand",children:"No notes found"}),(0,e.jsx)("p",{className:"text-gray-400 text-sm mt-1 font-manrope",children:a?"Try different keywords":"Create your first note"})]}):(0,e.jsx)("div",{className:"p-2",children:C.map((t,n)=>(0,e.jsx)(he,{note:t,isActive:r===t.id,onClick:()=>ce(t),isFirst:n===0,isLast:n===C.length-1,onArchiveToggle:_},t.id))})})]}),(0,e.jsx)("div",{className:N("flex flex-col transition-all duration-300",u?L?"w-full":"hidden":"flex-1"),children:r?(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(be,{title:h,onTitleChange:x,onDelete:de,isSaving:U.isPending,isDeleting:W.isPending,note:C.find(t=>t.id===r),onPin:fe,onColorChange:me,onArchive:_,onExport:ie,isSingleColumn:u,onBack:ue}),(0,e.jsx)("div",{className:"flex-1 p-3",style:{backgroundColor:r?Q(C.find(t=>t.id===r)||{}).bgValue:"#ffffff"},children:(0,e.jsx)("textarea",{value:y,onChange:t=>w(t.target.value),placeholder:"Start writing your note...",className:N("w-full h-full min-h-[400px] border-0 outline-none resize-none bg-transparent","font-manrope text-sm text-gray-700 placeholder:text-gray-400")})})]}):(0,e.jsx)("div",{className:"flex-1 flex items-center justify-center",style:{backgroundColor:"#ffffff"},children:(0,e.jsxs)("div",{className:"text-center max-w-md mx-auto p-6",children:[(0,e.jsx)("div",{className:"w-16 h-16 bg-gradient-to-br from-krushr-primary/10 to-krushr-primary/20 rounded-full flex items-center justify-center mx-auto mb-4",children:(0,e.jsx)(X,{className:"w-8 h-8 text-krushr-primary"})}),(0,e.jsx)("h3",{className:N("font-medium text-gray-900 mb-2 font-manrope",u?"text-base":"text-lg"),children:"Select a note to edit"}),(0,e.jsx)("p",{className:N("text-gray-500 leading-relaxed mb-4 font-manrope",u?"text-xs":"text-sm"),children:u?"Tap a note to start editing":"Choose a note from the sidebar to start editing, or create a new note to get started."}),!u&&(0,e.jsx)("button",{onClick:Y,disabled:O.isPending,className:"w-8 h-8 bg-krushr-primary text-white rounded-md flex items-center justify-center hover:bg-krushr-primary/90 disabled:opacity-50 transition-colors",title:"Create your first note",children:(0,e.jsx)($,{className:"w-4 h-4"})})]})})})]})});ne.displayName="NotesPanel";var Te=ne;export{Te as a};
