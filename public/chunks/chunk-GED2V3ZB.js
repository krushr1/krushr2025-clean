import{c as A,d as I,e as _,g as O}from"/chunks/chunk-E6NQKUEP.js";var y=A(I(),1);var w=A(_(),1),M=y.forwardRef(({className:t,...r},e)=>(0,w.jsx)("textarea",{className:O("flex min-h-[60px] w-full rounded-md border border-input bg-transparent px-3 py-2 text-base shadow-sm placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",t),ref:e,...r}));M.displayName="Textarea";var R=t=>{let r,e=new Set,o=(i,v)=>{let p=typeof i=="function"?i(r):i;if(!Object.is(p,r)){let f=r;r=v??(typeof p!="object"||p===null)?p:Object.assign({},r,p),e.forEach(S=>S(r,f))}},n=()=>r,d={setState:o,getState:n,getInitialState:()=>u,subscribe:i=>(e.add(i),()=>e.delete(i))},u=r=t(o,n,d);return d},C=t=>t?R(t):R;var h=A(I(),1);var L=t=>t;function F(t,r=L){let e=h.default.useSyncExternalStore(t.subscribe,()=>r(t.getState()),()=>r(t.getInitialState()));return h.default.useDebugValue(e),e}var x=t=>{let r=C(t),e=o=>F(r,o);return Object.assign(e,r),e},P=t=>t?x(t):x;var H=t=>(r,e,o)=>{let n=o.subscribe;return o.subscribe=(c,d,u)=>{let i=c;if(d){let v=u?.equalityFn||Object.is,p=c(o.getState());i=f=>{let S=c(f);if(!v(p,S)){let T=p;d(p=S,T)}},u?.fireImmediately&&d(p,p)}return n(i)},t(r,e,o)},W=H;function K(t,r){let e;try{e=t()}catch{return}return{getItem:n=>{var s;let c=u=>u===null?null:JSON.parse(u,r?.reviver),d=(s=e.getItem(n))!=null?s:null;return d instanceof Promise?d.then(c):c(d)},setItem:(n,s)=>e.setItem(n,JSON.stringify(s,r?.replacer)),removeItem:n=>e.removeItem(n)}}var N=t=>r=>{try{let e=t(r);return e instanceof Promise?e:{then(o){return N(o)(e)},catch(o){return this}}}catch(e){return{then(o){return this},catch(o){return N(o)(e)}}}},G=(t,r)=>(e,o,n)=>{let s={storage:K(()=>localStorage),partialize:a=>a,version:0,merge:(a,k)=>({...k,...a}),...r},c=!1,d=new Set,u=new Set,i=s.storage;if(!i)return t((...a)=>{console.warn(`[zustand persist middleware] Unable to update item '${s.name}', the given storage is currently unavailable.`),e(...a)},o,n);let v=()=>{let a=s.partialize({...o()});return i.setItem(s.name,{state:a,version:s.version})},p=n.setState;n.setState=(a,k)=>{p(a,k),v()};let f=t((...a)=>{e(...a),v()},o,n);n.getInitialState=()=>f;let S,T=()=>{var a,k;if(!i)return;c=!1,d.forEach(l=>{var m;return l((m=o())!=null?m:f)});let E=((k=s.onRehydrateStorage)==null?void 0:k.call(s,(a=o())!=null?a:f))||void 0;return N(i.getItem.bind(i))(s.name).then(l=>{if(l)if(typeof l.version=="number"&&l.version!==s.version){if(s.migrate){let m=s.migrate(l.state,l.version);return m instanceof Promise?m.then(g=>[!0,g]):[!0,m]}console.error("State loaded from storage couldn't be migrated since no migrate function was provided")}else return[!1,l.state];return[!1,void 0]}).then(l=>{var m;let[g,U]=l;if(S=s.merge(U,(m=o())!=null?m:f),e(S,!0),g)return v()}).then(()=>{E?.(S,void 0),S=o(),c=!0,u.forEach(l=>l(S))}).catch(l=>{E?.(void 0,l)})};return n.persist={setOptions:a=>{s={...s,...a},a.storage&&(i=a.storage)},clearStorage:()=>{i?.removeItem(s.name)},getOptions:()=>s,rehydrate:()=>T(),hasHydrated:()=>c,onHydrate:a=>(d.add(a),()=>{d.delete(a)}),onFinishHydration:a=>(u.add(a),()=>{u.delete(a)})},s.skipHydration||T(),S||f},$=G;var z={LOGIN:"/auth/login",REGISTER:"/auth/register",LOGOUT:"/auth/logout",ME:"/auth/me",WORKSPACES:"/workspaces",TEAMS:"/teams",KANBANS:"/kanbans",TASKS:"/tasks",PANELS:"/panels",NOTIFICATIONS:"/notifications",EMAILS:"/emails",CALENDAR:"/calendar",CHAT:"/chat",PERSONAL_CHAT:"/chat/personal",TEAM_CHAT:"/chat/team",OPENAI:"/openai",TAGS:"/tags"};var b={PERSONAL_CHAT_MESSAGE:"personal-chat-message",TEAM_CHAT_MESSAGE:"team-chat-message",NOTIFICATION_CREATED:"notification-created",TASK_UPDATED:"task-updated",KANBAN_UPDATED:"kanban-updated",USER_ONLINE:"user-online",USER_OFFLINE:"user-offline"};var D=P()(W((t,r)=>({user:null,isAuthenticated:!1,workspaces:[],activeWorkspace:null,teams:[],kanbans:[],tasks:[],notifications:[],sidebarOpen:!0,currentPage:"home",loading:!1,error:null,websocket:{connected:!1,socket:null,reconnectAttempts:0,maxReconnectAttempts:5},setUser:e=>t({user:e,isAuthenticated:!!e}),setActiveWorkspace:e=>t({activeWorkspace:e}),setWorkspaces:e=>t({workspaces:e}),setTeams:e=>t({teams:e}),setKanbans:e=>t({kanbans:e}),setTasks:e=>t({tasks:e}),addTask:e=>t(o=>({tasks:[...o.tasks,e]})),updateTask:(e,o)=>t(n=>({tasks:n.tasks.map(s=>s.id===e?{...s,...o}:s)})),deleteTask:e=>t(o=>({tasks:o.tasks.filter(n=>n.id!==e)})),setNotifications:e=>t({notifications:e}),addNotification:e=>t(o=>({notifications:[e,...o.notifications]})),markNotificationRead:e=>t(o=>({notifications:o.notifications.map(n=>n.id===e?{...n,is_read:!0}:n)})),setSidebarOpen:e=>t({sidebarOpen:e}),setCurrentPage:e=>t({currentPage:e}),setLoading:e=>t({loading:e}),setError:e=>t({error:e}),connectWebSocket:()=>{let e=r();if(e.websocket.socket||!e.isAuthenticated)return;let o="wss://api.krushr.app/ws";try{let n=new WebSocket(o);n.onopen=()=>{console.log("WebSocket connected"),t(s=>({websocket:{...s.websocket,connected:!0,socket:n,reconnectAttempts:0}}))},n.onmessage=s=>{try{let c=JSON.parse(s.data);j(c,t,r)}catch(c){console.error("WebSocket message parse error:",c)}},n.onclose=()=>{console.log("WebSocket disconnected"),t(c=>({websocket:{...c.websocket,connected:!1,socket:null}}));let s=r();s.websocket.reconnectAttempts<s.websocket.maxReconnectAttempts&&setTimeout(()=>{t(c=>({websocket:{...c.websocket,reconnectAttempts:c.websocket.reconnectAttempts+1}})),r().connectWebSocket()},2e3*Math.pow(2,s.websocket.reconnectAttempts))},n.onerror=s=>{console.error("WebSocket error:",s),t({error:"Connection error occurred"})}}catch(n){console.error("WebSocket connection failed:",n),t({error:"Failed to connect to real-time service"})}},disconnectWebSocket:()=>{let e=r();e.websocket.socket&&(e.websocket.socket.close(),t(o=>({websocket:{...o.websocket,connected:!1,socket:null}})))},sendMessage:(e,o)=>{let n=r();n.websocket.connected&&n.websocket.socket&&n.websocket.socket.send(JSON.stringify({event:e,data:o,timestamp:new Date().toISOString()}))}})));function j(t,r,e){let{event:o,data:n}=t;switch(o){case b.TASK_UPDATED:e().updateTask(n.id,n);break;case b.KANBAN_UPDATED:r(s=>({kanbans:s.kanbans.map(c=>c.id===n.id?n:c)}));break;case b.NOTIFICATION_CREATED:e().addNotification(n);break;case b.PERSONAL_CHAT_MESSAGE:case b.TEAM_CHAT_MESSAGE:console.log("Chat message received:",n);break;case b.USER_ONLINE:case b.USER_OFFLINE:console.log("User presence change:",n);break;default:console.log("Unknown WebSocket event:",o,n)}}var ne=()=>{let t=D(e=>e.websocket.connected),r=D(e=>e.sendMessage);return{connected:t,sendMessage:r}};export{P as a,$ as b,M as c,z as d,D as e,ne as f};
