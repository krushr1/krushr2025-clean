import{e as V}from"/chunks/chunk-Y23ZUE4R.js";import{c as p,d as b,e as O,f as k,g as N,vb as C}from"/chunks/chunk-XLF7ZOXQ.js";var L=p(b(),1);var B=e=>typeof e=="boolean"?`${e}`:e===0?"0":e,$=k,j=(e,o)=>t=>{var n;if(o?.variants==null)return $(e,t?.class,t?.className);let{variants:s,defaultVariants:c}=o,d=Object.keys(s).map(i=>{let l=t?.[i],r=c?.[i];if(l===null)return null;let a=B(l)||B(r);return s[i][a]}),u=t&&Object.entries(t).reduce((i,l)=>{let[r,a]=l;return a===void 0||(i[r]=a),i},{}),T=o==null||(n=o.compoundVariants)===null||n===void 0?void 0:n.reduce((i,l)=>{let{class:r,className:a,...m}=l;return Object.entries(m).every(g=>{let[A,S]=g;return Array.isArray(S)?S.includes({...c,...u}[A]):{...c,...u}[A]===S})?[...i,r,a]:i},[]);return $(e,d,T,t?.class,t?.className)};var F=p(O(),1),X=j("inline-flex items-center justify-center whitespace-nowrap rounded-lg text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-lg px-3",lg:"h-11 rounded-lg px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),_=L.forwardRef(({className:e,variant:o,size:t,asChild:n=!1,...s},c)=>(0,F.jsx)(n?V:"button",{className:N(X({variant:o,size:t,className:e})),ref:c,...s}));_.displayName="Button";var x=p(b(),1),Y=1,q=1e6;var w=0;function Z(){return w=(w+1)%Number.MAX_SAFE_INTEGER,w.toString()}var M=new Map,z=e=>{if(M.has(e))return;let o=setTimeout(()=>{M.delete(e),y({type:"REMOVE_TOAST",toastId:e})},q);M.set(e,o)},tt=(e,o)=>{switch(o.type){case"ADD_TOAST":return{...e,toasts:[o.toast,...e.toasts].slice(0,Y)};case"UPDATE_TOAST":return{...e,toasts:e.toasts.map(t=>t.id===o.toast.id?{...t,...o.toast}:t)};case"DISMISS_TOAST":{let{toastId:t}=o;return t?z(t):e.toasts.forEach(n=>{z(n.id)}),{...e,toasts:e.toasts.map(n=>n.id===t||t===void 0?{...n,open:!1}:n)}}case"REMOVE_TOAST":return o.toastId===void 0?{...e,toasts:[]}:{...e,toasts:e.toasts.filter(t=>t.id!==o.toastId)}}},I=[],h={toasts:[]};function y(e){h=tt(h,e),I.forEach(o=>{o(h)})}function et({...e}){let o=Z(),t=s=>y({type:"UPDATE_TOAST",toast:{...s,id:o}}),n=()=>y({type:"DISMISS_TOAST",toastId:o});return y({type:"ADD_TOAST",toast:{...e,id:o,open:!0,onOpenChange:s=>{s||n()}}}),{id:o,dismiss:n,update:t}}function H(){let[e,o]=x.useState(h);return x.useEffect(()=>(I.push(o),()=>{let t=I.indexOf(o);t>-1&&I.splice(t,1)}),[e]),{...e,toast:et,dismiss:t=>y({type:"DISMISS_TOAST",toastId:t})}}var K=e=>{let o,t=new Set,n=(i,l)=>{let r=typeof i=="function"?i(o):i;if(!Object.is(r,o)){let a=o;o=l??(typeof r!="object"||r===null)?r:Object.assign({},o,r),t.forEach(m=>m(o,a))}},s=()=>o,u={setState:n,getState:s,getInitialState:()=>T,subscribe:i=>(t.add(i),()=>t.delete(i))},T=o=e(n,s,u);return u},G=e=>e?K(e):K;var U=p(b(),1);var ot=e=>e;function nt(e,o=ot){let t=U.default.useSyncExternalStore(e.subscribe,()=>o(e.getState()),()=>o(e.getInitialState()));return U.default.useDebugValue(t),t}var J=e=>{let o=G(e),t=n=>nt(o,n);return Object.assign(t,o),t},Q=e=>e?J(e):J;var R=Q((e,o)=>({actions:new Map,addUndoableAction:(t,n,s,c,d=1e4)=>{let u=crypto.randomUUID(),T=Date.now(),i=T+d,l={id:u,type:t,description:n,data:s,timestamp:T,expiresAt:i,onUndo:c};return e(r=>{let a=new Map(r.actions);return a.set(u,l),{actions:a}}),setTimeout(()=>{o().removeAction(u)},d),u},undo:async t=>{let n=o().actions.get(t);if(n)try{await n.onUndo(),o().removeAction(t)}catch(s){throw console.error("Failed to undo action:",s),s}},cleanupExpired:()=>{let t=Date.now();e(n=>{let s=new Map;return n.actions.forEach((c,d)=>{c.expiresAt>t&&s.set(d,c)}),{actions:s}})},removeAction:t=>{e(n=>{let s=new Map(n.actions);return s.delete(t),{actions:s}})},getAction:t=>o().actions.get(t)}));typeof window<"u"&&setInterval(()=>{R.getState().cleanupExpired()},5e3);var E=p(b(),1),D=p(O(),1);function gt(){let{toast:e}=H(),{addUndoableAction:o,removeAction:t}=R(),[n]=(0,E.useState)(new Map),s=(0,E.useRef)(new Map);return{deleteItem:async({type:d,item:u,itemName:T,deleteAction:i,onOptimisticRemove:l,onRestore:r,ttl:a=1e4})=>{let m=`${d}-${Date.now()}-${Math.random()}`;n.set(m,u),l?.();let g={task:"Task",note:"Note",column:"Column",comment:"Comment",conversation:"Conversation",panel:"Panel","bulk-tasks":"Tasks"},A=`${g[d]} ${T?`"${T}" `:""}deleted`,S=async()=>{let f=s.current.get(m);f&&(clearTimeout(f),s.current.delete(m));let v=n.get(m);v&&r&&r(v),n.delete(m)},P=o(d,A,u,S,a);e({title:A,duration:a,action:(0,D.jsxs)(_,{size:"sm",variant:"outline",onClick:async()=>{try{await S(),t(P),e({title:`${g[d]} restored`,duration:3e3})}catch{e({title:"Failed to undo",description:"The action could not be undone",variant:"destructive"})}},className:"ml-auto",children:[(0,D.jsx)(C,{className:"mr-1 h-3 w-3"}),"Undo"]}),onOpenChange:f=>{f||t(P)}});let W=setTimeout(async()=>{try{await i(),n.delete(m),s.current.delete(m)}catch(f){if(console.error("Failed to delete item:",f),r){let v=n.get(m);v&&r(v)}e({title:"Delete failed",description:"The item could not be deleted",variant:"destructive"})}},a);return s.current.set(m,W),!0}}}export{Q as a,j as b,X as c,_ as d,H as e,R as f,gt as g};
