import{a as u,c as re}from"/chunks/chunk-JTMKD6PY.js";import{a as J,g as ae}from"/chunks/chunk-JHM7S6XW.js";import{d as p}from"/chunks/chunk-5JTNGE7Q.js";import{La as Z,Oa as ee,Ta as te,Za as O,c as E,d as q,e as G,g as N,j as F,k as X,kb as j,qb as oe}from"/chunks/chunk-XLF7ZOXQ.js";var s=E(q(),1);var A=E(q(),1),V=768;function ne(){let[o,a]=A.useState(void 0);return A.useEffect(()=>{let d=window.matchMedia(`(max-width: ${V-1}px)`),r=()=>{a(window.innerWidth<V)};return d.addEventListener("change",r),a(window.innerWidth<V),()=>d.removeEventListener("change",r)},[]),!!o}var se=J(o=>({showTaskCreationModal:!1,taskCreationColumnId:void 0,taskCreationKanbanId:void 0,showCommandPalette:!1,showLayoutManager:!1,layoutManagerMode:void 0,shouldCreateNote:!1,focusMode:!1,focusedPanelId:void 0,openTaskCreationModal:a=>o({showTaskCreationModal:!0,taskCreationColumnId:a?.columnId,taskCreationKanbanId:a?.kanbanId}),closeTaskCreationModal:()=>o({showTaskCreationModal:!1,taskCreationColumnId:void 0,taskCreationKanbanId:void 0}),toggleCommandPalette:()=>o(a=>({showCommandPalette:!a.showCommandPalette})),setCommandPalette:a=>o({showCommandPalette:a}),openLayoutManager:a=>o({showLayoutManager:!0,layoutManagerMode:a||"save"}),closeLayoutManager:()=>o({showLayoutManager:!1,layoutManagerMode:void 0}),triggerNoteCreation:()=>o({shouldCreateNote:!0}),clearNoteCreation:()=>o({shouldCreateNote:!1}),toggleFocusMode:a=>o(d=>a?d.focusMode&&d.focusedPanelId===a?{focusMode:!1,focusedPanelId:void 0}:{focusMode:!0,focusedPanelId:a}:{focusMode:!d.focusMode,focusedPanelId:d.focusMode?void 0:d.focusedPanelId}),exitFocusMode:()=>o({focusMode:!1,focusedPanelId:void 0})}));var e=E(G(),1),$=[{name:"Yellow",value:"#fef3c7",bgValue:"#fffbeb",border:"#f59e0b"},{name:"Pink",value:"#fce7f3",bgValue:"#fdf2f8",border:"#ec4899"},{name:"Blue",value:"#dbeafe",bgValue:"#eff6ff",border:"#3b82f6"},{name:"Green",value:"#d1fae5",bgValue:"#f0fdf4",border:"#10b981"},{name:"Purple",value:"#e9d5ff",bgValue:"#faf5ff",border:"#8b5cf6"},{name:"Orange",value:"#fed7aa",bgValue:"#fff7ed",border:"#f97316"},{name:"Red",value:"#fecaca",bgValue:"#fef2f2",border:"#ef4444"},{name:"None",value:"#ffffff",bgValue:"#ffffff",border:"#e5e7eb"}],B=o=>{let a=o.color||o.folder?.color||"#ffffff";return $.find(r=>r.value.toLowerCase()===a.toLowerCase())||$[7]};function xe({note:o,isActive:a,onClick:d,isFirst:r,isLast:c,onArchiveToggle:i}){let M=x=>{let w=new Date(x),g=Math.abs(new Date().getTime()-w.getTime()),v=Math.ceil(g/(1e3*60*60*24));return v===1?"Today":v===2?"Yesterday":v<=7?`${v-1}d ago`:w.toLocaleDateString("en-US",{month:"short",day:"numeric"})},h=B(o);return(0,e.jsxs)("div",{onClick:d,className:N("border rounded-md p-1.5 cursor-pointer transition-all duration-200 mb-1",a?"border border-krushr-primary shadow-md":"border border-gray-300 shadow-sm hover:shadow-md transition-shadow hover:border-krushr-primary/50"),style:{backgroundColor:a?"rgba(20, 49, 151, 0.05)":h.bgValue,borderLeftColor:h.border,borderLeftWidth:"3px",borderLeftStyle:"solid"},children:[(0,e.jsxs)("div",{className:"flex items-center justify-between gap-1 mb-1",children:[(0,e.jsx)("h4",{className:N("font-medium line-clamp-1 flex-1 min-w-0 font-brand text-sm",a?"text-krushr-primary":"text-gray-900"),children:o.title||"Untitled"}),(0,e.jsxs)("div",{className:"flex items-center gap-0.5 flex-shrink-0",children:[(0,e.jsx)("span",{className:"text-xs text-gray-500 font-manrope",children:M(o.updatedAt)}),o.isPinned&&(0,e.jsx)(j,{className:"w-2.5 h-2.5 text-amber-500 fill-current"}),o.isArchived&&(0,e.jsx)(F,{className:"w-2.5 h-2.5 text-krushr-gray-400"})]})]}),o.content&&(0,e.jsx)("p",{className:"text-xs text-gray-600 line-clamp-1 font-manrope",children:o.content})]})}function we({value:o,onChange:a,onCreateNote:d,isCreating:r}){return(0,e.jsx)("div",{className:"p-2 w-full",children:(0,e.jsxs)("div",{className:"relative flex items-center bg-white border border-gray-300 rounded-lg shadow-sm hover:shadow-md transition-shadow focus-within:shadow-md focus-within:border-krushr-primary h-8",children:[(0,e.jsx)("div",{className:"flex items-center pl-2.5",children:(0,e.jsx)(O,{className:"w-3.5 h-3.5 text-gray-400"})}),(0,e.jsx)("input",{type:"search",value:o,onChange:c=>a(c.target.value),placeholder:"Search notes...",className:"flex-1 min-w-0 h-6 text-sm font-manrope bg-transparent border-0 outline-none px-2 placeholder:text-gray-400 focus:ring-0"}),(0,e.jsx)("div",{className:"flex items-center pr-1",children:(0,e.jsx)("button",{onClick:d,disabled:r,className:"bg-krushr-primary text-white w-6 h-6 rounded-md flex items-center justify-center hover:bg-krushr-primary/90 transition-all duration-200 disabled:opacity-50 flex-shrink-0",title:"Create new note",children:r?(0,e.jsx)("div",{className:"w-2 h-2 border border-white border-t-transparent rounded-full animate-spin"}):(0,e.jsx)(te,{className:"w-3 h-3"})})})]})})}function ye({title:o,onTitleChange:a,onDelete:d,isSaving:r,isDeleting:c,note:i,onPin:M,onColorChange:h,onArchive:x,onExport:w,isSingleColumn:y,onBack:g}){let[v,f]=(0,s.useState)(!1);return(0,e.jsx)("div",{className:"p-2 bg-white",children:(0,e.jsxs)("div",{className:"flex items-center gap-1 mb-1",children:[y&&g&&(0,e.jsx)("button",{onClick:g,className:"w-6 h-6 flex items-center justify-center text-krushr-gray-600 hover:text-krushr-primary transition-colors flex-shrink-0",type:"button",title:"Back to Notes",children:(0,e.jsx)(X,{className:"w-4 h-4"})}),(0,e.jsxs)("div",{className:"flex-1 relative",children:[(0,e.jsx)("input",{type:"text",value:o,onChange:b=>a(b.target.value),placeholder:"Note title...",className:"w-full h-6 font-medium text-gray-900 font-brand bg-transparent border-0 outline-none placeholder:text-gray-400 focus:bg-krushr-gray-50 rounded px-2 pr-14 transition-colors text-sm"}),(0,e.jsx)("div",{className:"absolute right-1 top-1/2 -translate-y-1/2 flex items-center gap-0.5 text-xs",children:r?(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)("div",{className:"w-1 h-1 bg-amber-500 rounded-full animate-pulse"}),(0,e.jsx)("span",{className:"text-amber-600 font-medium font-manrope text-xs",children:"Save"})]}):(0,e.jsx)("div",{className:"w-1 h-1 bg-green-500 rounded-full"})})]}),(0,e.jsxs)("div",{className:"flex items-center gap-0.5",children:[i&&(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)("button",{onClick:()=>M(i.id),className:`w-5 h-5 flex items-center justify-center rounded transition-colors ${i.isPinned?"text-amber-500":"text-krushr-gray-400 hover:text-amber-500"}`,title:i.isPinned?"Unpin":"Pin",children:(0,e.jsx)(j,{className:`w-2.5 h-2.5 ${i.isPinned?"fill-current":""}`})}),(0,e.jsx)("button",{onClick:()=>x?.(i.id),className:`w-5 h-5 flex items-center justify-center rounded transition-colors ${i.isArchived?"text-krushr-primary":"text-krushr-gray-400 hover:text-krushr-primary"}`,title:i.isArchived?"Unarchive":"Archive",children:(0,e.jsx)(F,{className:"w-2.5 h-2.5"})}),(0,e.jsxs)("div",{className:"relative",children:[(0,e.jsx)("button",{onClick:()=>f(!v),className:"w-5 h-5 flex items-center justify-center rounded transition-colors text-krushr-gray-400 hover:text-krushr-gray-600",title:"Color",children:(0,e.jsx)(Z,{className:"w-2.5 h-2.5"})}),v&&(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)("div",{className:"fixed inset-0 z-40",onClick:()=>f(!1)}),(0,e.jsx)("div",{className:"absolute top-full right-0 mt-0.5 bg-white border border-krushr-gray-200 rounded-lg shadow-xl p-1.5 z-50",children:(0,e.jsx)("div",{style:{display:"grid",gridTemplateColumns:"repeat(4, 1fr)",gap:"3px"},children:$.map(b=>(0,e.jsx)("button",{onClick:()=>{h(i.id,b.value),f(!1)},className:`w-5 h-5 rounded border hover:scale-110 transition-transform ${B(i).value===b.value?"border-krushr-primary ring-2 ring-krushr-primary/30":"border-krushr-gray-300 hover:border-krushr-primary/50"}`,style:{backgroundColor:b.bgValue},title:b.name},b.value))})})]})]})]}),(0,e.jsx)("button",{onClick:d,disabled:c,className:"w-5 h-5 text-krushr-gray-400 hover:text-red-500 rounded flex items-center justify-center transition-colors disabled:opacity-50",title:"Delete",children:c?(0,e.jsx)("div",{className:"w-2.5 h-2.5 border border-red-500 border-t-transparent rounded-full animate-spin"}):(0,e.jsx)(oe,{className:"w-2.5 h-2.5"})})]})]})})}var ie=s.default.forwardRef(({workspaceId:o,className:a},d)=>{let[r,c]=(0,s.useState)(null),[i,M]=(0,s.useState)(""),[h,x]=(0,s.useState)(""),[w,y]=(0,s.useState)(""),[g,v]=(0,s.useState)(null),[f,b]=(0,s.useState)(!1),[L,D]=(0,s.useState)(!1),[z,R]=(0,s.useState)(new Set),S=(0,s.useRef)(null),Q=ne(),{activeContextType:de,activeEntityId:le}=re(),{shouldCreateNote:K,clearNoteCreation:ce}=se(),m=p.notes.list.useQuery({workspaceId:o,search:i||void 0,taskId:de==="task"?le:void 0}),C=p.notes.get.useQuery({id:r},{enabled:!!r}),W=p.notes.create.useMutation({onSuccess:t=>{c(t.id),x(t.title),y(t.content||""),m.refetch(),u.success("Note created")}}),U=p.notes.update.useMutation({onSuccess:()=>{m.refetch(),C.refetch()}}),H=p.notes.delete.useMutation({onSuccess:()=>{c(null),x(""),y(""),m.refetch(),u.success("Note deleted")}}),ue=p.notes.togglePin.useMutation({onSuccess:()=>{m.refetch(),C.refetch(),u.success("Note pin status updated")},onError:t=>{u.error("Failed to update pin status")}}),fe=p.notes.toggleArchive.useMutation({onSuccess:()=>{m.refetch(),C.refetch(),u.success("Note archive status updated")},onError:t=>{u.error("Failed to update archive status")}}),me=()=>{try{let t=k.filter(T=>!T.isArchived),n="# Notes Export\\n\\n";t.forEach(T=>{n+=`## ${T.title}\\n\\n`,n+=`${T.content||"No content"}\\n\\n`,n+=`*Updated: ${new Date(T.updatedAt).toLocaleDateString()}*\\n\\n`,n+="---\\n\\n"});let l=new Blob([n],{type:"text/markdown"}),P=URL.createObjectURL(l),I=document.createElement("a");I.href=P,I.download=`notes-export-${new Date().toISOString().split("T")[0]}.md`,document.body.appendChild(I),I.click(),document.body.removeChild(I),URL.revokeObjectURL(P),u.success("Notes exported successfully")}catch{u.error("Failed to export notes")}},Ce=p.notes.update.useMutation({onSuccess:()=>{m.refetch(),u.success("Note folder updated")},onError:t=>{u.error("Failed to update note folder")}});(0,s.useEffect)(()=>{C.data&&(x(C.data.title),y(C.data.content||""))},[C.data]),(0,s.useEffect)(()=>{K&&(Y(),ce())},[K]),(0,s.useEffect)(()=>{let t=()=>{if(S.current){let P=S.current.offsetWidth<360||Q;b(P),P&&r&&!L&&D(!0)}};t();let n=new ResizeObserver(t);return S.current&&n.observe(S.current),()=>n.disconnect()},[r,Q,L]),(0,s.useEffect)(()=>{if(r&&(h||w)){g&&clearTimeout(g);let t=setTimeout(()=>{U.mutate({id:r,title:h||"Untitled",content:w})},1e3);v(t)}return()=>{g&&clearTimeout(g)}},[h,w,r]);let Y=()=>{W.mutate({title:"New Note",content:"",workspaceId:o,tags:[]})},{deleteItem:he}=ae(),ge=async()=>{if(!r)return;let t=m.data?.notes?.find(n=>n.id===r);t&&await he({type:"note",item:t,itemName:t.title||"Untitled note",deleteAction:async()=>{await H.mutateAsync({id:r}),R(n=>{let l=new Set(n);return l.delete(r),l})},onOptimisticRemove:()=>{R(l=>new Set(l).add(r));let n=m.data?.notes?.filter(l=>l.id!==r&&!z.has(l.id));c(n?.[0]?.id||null)},onRestore:()=>{R(n=>{let l=new Set(n);return l.delete(t.id),l}),c(t.id)}})},ve=t=>{c(t.id),f&&D(!0)},be=()=>{D(!1),c(null)},pe=t=>{ue.mutate({id:t})},_=t=>{fe.mutate({id:t})},Ne=(t,n)=>{U.mutate({id:t,color:n}),u.success("Note color updated")},k=(m.data?.notes||[]).filter(t=>!z.has(t.id)&&(i?t.title.toLowerCase().includes(i.toLowerCase())||t.content?.toLowerCase().includes(i.toLowerCase()):!0));return(0,e.jsxs)("div",{ref:S,className:N("flex h-full bg-krushr-gray-50",a),children:[(0,e.jsxs)("div",{className:N("bg-white flex flex-col shadow-sm transition-all duration-300",f?L?"hidden":"w-full":"w-80"),children:[(0,e.jsx)(we,{value:i,onChange:M,onCreateNote:Y,isCreating:W.isPending}),(0,e.jsx)("div",{className:"flex-1 overflow-y-auto",children:m.isLoading?(0,e.jsx)("div",{className:"flex items-center justify-center py-8",children:(0,e.jsx)("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-krushr-primary"})}):k.length===0?(0,e.jsxs)("div",{className:"p-6 text-center",children:[(0,e.jsx)("div",{className:"w-10 h-10 bg-krushr-gray-100 rounded-full flex items-center justify-center mx-auto mb-2",children:(0,e.jsx)(O,{className:"w-5 h-5 text-krushr-gray-400"})}),(0,e.jsx)("p",{className:"text-gray-900 font-medium font-brand",children:"No notes found"}),(0,e.jsx)("p",{className:"text-gray-400 text-sm mt-1 font-manrope",children:i?"Try different keywords":"Create your first note"})]}):(0,e.jsx)("div",{className:"p-1.5",children:k.map((t,n)=>(0,e.jsx)(xe,{note:t,isActive:r===t.id,onClick:()=>ve(t),isFirst:n===0,isLast:n===k.length-1,onArchiveToggle:_},t.id))})})]}),(0,e.jsx)("div",{className:N("flex flex-col transition-all duration-300",f?L?"w-full":"hidden":"flex-1"),children:r?(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(ye,{title:h,onTitleChange:x,onDelete:ge,isSaving:U.isPending,isDeleting:H.isPending,note:k.find(t=>t.id===r),onPin:pe,onColorChange:Ne,onArchive:_,onExport:me,isSingleColumn:f,onBack:be}),(0,e.jsx)("div",{className:"flex-1 p-2",style:{backgroundColor:r?B(k.find(t=>t.id===r)||{}).bgValue:"#ffffff"},children:(0,e.jsx)("textarea",{value:w,onChange:t=>y(t.target.value),placeholder:"Start writing your note...",className:N("w-full h-full min-h-[300px] border-0 outline-none resize-none bg-transparent","font-manrope text-sm text-gray-700 placeholder:text-gray-400")})})]}):(0,e.jsx)("div",{className:"flex-1 flex items-center justify-center",style:{backgroundColor:"#ffffff"},children:(0,e.jsxs)("div",{className:"text-center max-w-md mx-auto p-6",children:[(0,e.jsx)("div",{className:"w-16 h-16 bg-gradient-to-br from-krushr-primary/10 to-krushr-primary/20 rounded-full flex items-center justify-center mx-auto mb-4",children:(0,e.jsx)(ee,{className:"w-8 h-8 text-krushr-primary"})}),(0,e.jsx)("h3",{className:N("font-medium text-gray-900 mb-2 font-manrope",f?"text-base":"text-lg"),children:"Select a note to edit"}),(0,e.jsx)("p",{className:N("text-gray-500 leading-relaxed mb-4 font-manrope",f?"text-xs":"text-sm"),children:f?"Tap a note to start editing":"Choose a note from the sidebar to start editing, or create a new note to get started."})]})})})]})});ie.displayName="NotesPanel";var Ue=ie;export{se as a,Ue as b};
