import{b as A,c as N,d as _,f as O}from"/chunks/chunk-PGPPHKG2.js";var y=t=>{let r,e=new Set,o=(c,b)=>{let p=typeof c=="function"?c(r):c;if(!Object.is(p,r)){let S=r;r=b??(typeof p!="object"||p===null)?p:Object.assign({},r,p),e.forEach(f=>f(r,S))}},n=()=>r,l={setState:o,getState:n,getInitialState:()=>u,subscribe:c=>(e.add(c),()=>e.delete(c))},u=r=t(o,n,l);return l},w=t=>t?y(t):y;var h=A(N(),1);var U=t=>t;function L(t,r=U){let e=h.default.useSyncExternalStore(t.subscribe,()=>r(t.getState()),()=>r(t.getInitialState()));return h.default.useDebugValue(e),e}var R=t=>{let r=w(t),e=o=>L(r,o);return Object.assign(e,r),e},C=t=>t?R(t):R;var F=t=>(r,e,o)=>{let n=o.subscribe;return o.subscribe=(i,l,u)=>{let c=i;if(l){let b=u?.equalityFn||Object.is,p=i(o.getState());c=S=>{let f=i(S);if(!b(p,f)){let E=p;l(p=f,E)}},u?.fireImmediately&&l(p,p)}return n(c)},t(r,e,o)},P=F;function H(t,r){let e;try{e=t()}catch{return}return{getItem:n=>{var s;let i=u=>u===null?null:JSON.parse(u,r?.reviver),l=(s=e.getItem(n))!=null?s:null;return l instanceof Promise?l.then(i):i(l)},setItem:(n,s)=>e.setItem(n,JSON.stringify(s,r?.replacer)),removeItem:n=>e.removeItem(n)}}var I=t=>r=>{try{let e=t(r);return e instanceof Promise?e:{then(o){return I(o)(e)},catch(o){return this}}}catch(e){return{then(o){return this},catch(o){return I(o)(e)}}}},K=(t,r)=>(e,o,n)=>{let s={storage:H(()=>localStorage),partialize:a=>a,version:0,merge:(a,k)=>({...k,...a}),...r},i=!1,l=new Set,u=new Set,c=s.storage;if(!c)return t((...a)=>{console.warn(`[zustand persist middleware] Unable to update item '${s.name}', the given storage is currently unavailable.`),e(...a)},o,n);let b=()=>{let a=s.partialize({...o()});return c.setItem(s.name,{state:a,version:s.version})},p=n.setState;n.setState=(a,k)=>{p(a,k),b()};let S=t((...a)=>{e(...a),b()},o,n);n.getInitialState=()=>S;let f,E=()=>{var a,k;if(!c)return;i=!1,l.forEach(d=>{var m;return d((m=o())!=null?m:S)});let T=((k=s.onRehydrateStorage)==null?void 0:k.call(s,(a=o())!=null?a:S))||void 0;return I(c.getItem.bind(c))(s.name).then(d=>{if(d)if(typeof d.version=="number"&&d.version!==s.version){if(s.migrate){let m=s.migrate(d.state,d.version);return m instanceof Promise?m.then(g=>[!0,g]):[!0,m]}console.error("State loaded from storage couldn't be migrated since no migrate function was provided")}else return[!1,d.state];return[!1,void 0]}).then(d=>{var m;let[g,M]=d;if(f=s.merge(M,(m=o())!=null?m:S),e(f,!0),g)return b()}).then(()=>{T?.(f,void 0),f=o(),i=!0,u.forEach(d=>d(f))}).catch(d=>{T?.(void 0,d)})};return n.persist={setOptions:a=>{s={...s,...a},a.storage&&(c=a.storage)},clearStorage:()=>{c?.removeItem(s.name)},getOptions:()=>s,rehydrate:()=>E(),hasHydrated:()=>i,onHydrate:a=>(l.add(a),()=>{l.delete(a)}),onFinishHydration:a=>(u.add(a),()=>{u.delete(a)})},s.skipHydration||E(),f||S},X=K;var $={LOGIN:"/auth/login",REGISTER:"/auth/register",LOGOUT:"/auth/logout",ME:"/auth/me",WORKSPACES:"/workspaces",TEAMS:"/teams",KANBANS:"/kanbans",TASKS:"/tasks",PANELS:"/panels",NOTIFICATIONS:"/notifications",EMAILS:"/emails",CALENDAR:"/calendar",CHAT:"/chat",PERSONAL_CHAT:"/chat/personal",TEAM_CHAT:"/chat/team",OPENAI:"/openai",TAGS:"/tags"};var v={PERSONAL_CHAT_MESSAGE:"personal-chat-message",TEAM_CHAT_MESSAGE:"team-chat-message",NOTIFICATION_CREATED:"notification-created",TASK_UPDATED:"task-updated",KANBAN_UPDATED:"kanban-updated",USER_ONLINE:"user-online",USER_OFFLINE:"user-offline"};var W=C()(P((t,r)=>({user:null,isAuthenticated:!1,workspaces:[],activeWorkspace:null,teams:[],kanbans:[],tasks:[],notifications:[],sidebarOpen:!0,currentPage:"home",loading:!1,error:null,websocket:{connected:!1,socket:null,reconnectAttempts:0,maxReconnectAttempts:5},setUser:e=>t({user:e,isAuthenticated:!!e}),setActiveWorkspace:e=>t({activeWorkspace:e}),setWorkspaces:e=>t({workspaces:e}),setTeams:e=>t({teams:e}),setKanbans:e=>t({kanbans:e}),setTasks:e=>t({tasks:e}),addTask:e=>t(o=>({tasks:[...o.tasks,e]})),updateTask:(e,o)=>t(n=>({tasks:n.tasks.map(s=>s.id===e?{...s,...o}:s)})),deleteTask:e=>t(o=>({tasks:o.tasks.filter(n=>n.id!==e)})),setNotifications:e=>t({notifications:e}),addNotification:e=>t(o=>({notifications:[e,...o.notifications]})),markNotificationRead:e=>t(o=>({notifications:o.notifications.map(n=>n.id===e?{...n,is_read:!0}:n)})),setSidebarOpen:e=>t({sidebarOpen:e}),setCurrentPage:e=>t({currentPage:e}),setLoading:e=>t({loading:e}),setError:e=>t({error:e}),connectWebSocket:()=>{let e=r();if(e.websocket.socket||!e.isAuthenticated)return;let o="wss://api.krushr.app/ws";try{let n=new WebSocket(o);n.onopen=()=>{console.log("WebSocket connected"),t(s=>({websocket:{...s.websocket,connected:!0,socket:n,reconnectAttempts:0}}))},n.onmessage=s=>{try{let i=JSON.parse(s.data);G(i,t,r)}catch(i){console.error("WebSocket message parse error:",i)}},n.onclose=()=>{console.log("WebSocket disconnected"),t(i=>({websocket:{...i.websocket,connected:!1,socket:null}}));let s=r();s.websocket.reconnectAttempts<s.websocket.maxReconnectAttempts&&setTimeout(()=>{t(i=>({websocket:{...i.websocket,reconnectAttempts:i.websocket.reconnectAttempts+1}})),r().connectWebSocket()},2e3*Math.pow(2,s.websocket.reconnectAttempts))},n.onerror=s=>{console.error("WebSocket error:",s),t({error:"Connection error occurred"})}}catch(n){console.error("WebSocket connection failed:",n),t({error:"Failed to connect to real-time service"})}},disconnectWebSocket:()=>{let e=r();e.websocket.socket&&(e.websocket.socket.close(),t(o=>({websocket:{...o.websocket,connected:!1,socket:null}})))},sendMessage:(e,o)=>{let n=r();n.websocket.connected&&n.websocket.socket&&n.websocket.socket.send(JSON.stringify({event:e,data:o,timestamp:new Date().toISOString()}))}})));function G(t,r,e){let{event:o,data:n}=t;switch(o){case v.TASK_UPDATED:e().updateTask(n.id,n);break;case v.KANBAN_UPDATED:r(s=>({kanbans:s.kanbans.map(i=>i.id===n.id?n:i)}));break;case v.NOTIFICATION_CREATED:e().addNotification(n);break;case v.PERSONAL_CHAT_MESSAGE:case v.TEAM_CHAT_MESSAGE:console.log("Chat message received:",n);break;case v.USER_ONLINE:case v.USER_OFFLINE:console.log("User presence change:",n);break;default:console.log("Unknown WebSocket event:",o,n)}}var ee=()=>{let t=W(e=>e.websocket.connected),r=W(e=>e.sendMessage);return{connected:t,sendMessage:r}};var x=A(N(),1);var D=A(_(),1),j=x.forwardRef(({className:t,type:r,...e},o)=>(0,D.jsx)("input",{type:r,className:O("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",t),ref:o,...e}));j.displayName="Input";export{C as a,X as b,$ as c,W as d,ee as e,j as f};
