import{a as c}from"/chunks/chunk-B565GQFQ.js";import{a as Z}from"/chunks/chunk-IANVKD3C.js";import{c as b}from"/chunks/chunk-6W2CN5GW.js";import{Da as U,Ha as K,Sa as $,Wa as X,c as D,d as Y,e as _,g as p,k as V,l as q,wa as G,za as J}from"/chunks/chunk-UTGMEFH3.js";var n=D(Y(),1);var M=D(Y(),1),B=768;function ee(){let[o,a]=M.useState(void 0);return M.useEffect(()=>{let l=window.matchMedia(`(max-width: ${B-1}px)`),r=()=>{a(window.innerWidth<B)};return l.addEventListener("change",r),a(window.innerWidth<B),()=>l.removeEventListener("change",r)},[]),!!o}var e=D(_(),1),F=[{name:"Yellow",value:"#fef3c7",bgValue:"#fffbeb",border:"#f59e0b"},{name:"Pink",value:"#fce7f3",bgValue:"#fdf2f8",border:"#ec4899"},{name:"Blue",value:"#dbeafe",bgValue:"#eff6ff",border:"#3b82f6"},{name:"Green",value:"#d1fae5",bgValue:"#f0fdf4",border:"#10b981"},{name:"Purple",value:"#e9d5ff",bgValue:"#faf5ff",border:"#8b5cf6"},{name:"Orange",value:"#fed7aa",bgValue:"#fff7ed",border:"#f97316"},{name:"Red",value:"#fecaca",bgValue:"#fef2f2",border:"#ef4444"},{name:"None",value:"#ffffff",bgValue:"#ffffff",border:"#e5e7eb"}],z=o=>{let a=o.color||o.folder?.color||"#ffffff",l=F.find(r=>r.value.toLowerCase()===a.toLowerCase())||F[7];return console.log("Note color debug:",{noteId:o.id,individualColor:o.color,folderColor:o.folder?.color,finalColor:a,colorConfig:l}),l};function ce({note:o,isActive:a,onClick:l,isFirst:r,isLast:u,onArchiveToggle:s}){let S=v=>{let N=new Date(v),m=Math.abs(new Date().getTime()-N.getTime()),h=Math.ceil(m/(1e3*60*60*24));return h===1?"Today":h===2?"Yesterday":h<=7?`${h-1}d ago`:N.toLocaleDateString("en-US",{month:"short",day:"numeric"})},f=z(o);return(0,e.jsxs)("div",{onClick:l,className:p("border rounded-md p-2 cursor-pointer transition-all duration-200 mb-1",a?"border border-krushr-primary shadow-md":"border border-krushr-gray-200 hover:border-krushr-primary/50 hover:shadow-sm"),style:{backgroundColor:a?"rgba(20, 49, 151, 0.05)":f.bgValue,borderLeftColor:f.border,borderLeftWidth:"3px",borderLeftStyle:"solid"},children:[(0,e.jsxs)("div",{className:"flex items-start justify-between gap-2 mb-3",children:[(0,e.jsx)("h4",{className:p("font-medium line-clamp-2 flex-1 font-brand",a?"text-krushr-primary":"text-gray-900"),children:o.title||"Untitled"}),(0,e.jsxs)("div",{className:"flex items-center gap-1 flex-shrink-0",children:[o.isPinned&&(0,e.jsx)($,{className:"w-3 h-3 text-amber-500 fill-current"}),o.isArchived&&(0,e.jsx)(V,{className:"w-3 h-3 text-krushr-gray-400"})]})]}),o.content&&(0,e.jsx)("p",{className:"text-sm text-gray-600 mb-3 line-clamp-2 font-manrope",children:o.content}),(0,e.jsxs)("div",{className:"flex items-center justify-between text-xs text-gray-500 font-manrope",children:[(0,e.jsx)("span",{children:S(o.updatedAt)}),(0,e.jsx)("span",{children:new Date(o.updatedAt).toLocaleDateString()})]})]})}function ue({value:o,onChange:a,onCreateNote:l,isCreating:r}){return(0,e.jsx)("div",{className:"p-3 border-b border-krushr-gray-200 w-full",children:(0,e.jsxs)("div",{className:"flex items-center gap-2 w-full",children:[(0,e.jsx)(Z,{label:"Search notes",value:o,onChange:u=>a(u.target.value),className:"flex-1 min-w-0 h-8 text-sm font-manrope border border-krushr-gray-300 focus:border-krushr-primary focus:ring-2 focus:ring-krushr-primary/20 transition-all duration-200",type:"search"}),(0,e.jsx)("button",{onClick:l,disabled:r,className:"bg-krushr-primary text-white w-8 h-8 rounded-md flex items-center justify-center hover:bg-krushr-primary/90 transition-all duration-200 disabled:opacity-50 flex-shrink-0",title:"Create new note",children:r?(0,e.jsx)("div",{className:"w-3 h-3 border border-white border-t-transparent rounded-full animate-spin"}):(0,e.jsx)(U,{className:"w-4 h-4"})})]})})}function fe({title:o,onTitleChange:a,onDelete:l,isSaving:r,isDeleting:u,note:s,onPin:S,onColorChange:f,onArchive:v,onExport:N,isSingleColumn:y,onBack:m}){let[h,d]=(0,n.useState)(!1);return(0,e.jsx)("div",{className:"p-3 border-b border-krushr-gray-200 bg-white",children:(0,e.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[y&&m&&(0,e.jsx)("button",{onClick:m,className:"w-6 h-6 flex items-center justify-center text-krushr-gray-600 hover:text-krushr-primary transition-colors flex-shrink-0",type:"button",title:"Back to Notes",children:(0,e.jsx)(q,{className:"w-4 h-4"})}),(0,e.jsxs)("div",{className:"flex-1 relative",children:[(0,e.jsx)("input",{type:"text",value:o,onChange:g=>a(g.target.value),placeholder:"Note title...",className:"w-full h-7 font-medium text-gray-900 font-brand bg-transparent border-0 outline-none placeholder:text-gray-400 focus:bg-krushr-gray-50 rounded px-2 pr-16 transition-colors"}),(0,e.jsx)("div",{className:"absolute right-2 top-1/2 -translate-y-1/2 flex items-center gap-1 text-xs",children:r?(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)("div",{className:"w-1.5 h-1.5 bg-amber-500 rounded-full animate-pulse"}),(0,e.jsx)("span",{className:"text-amber-600 font-medium font-manrope",children:"Saving"})]}):(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)("div",{className:"w-1.5 h-1.5 bg-green-500 rounded-full"}),(0,e.jsx)("span",{className:"text-green-600 font-medium font-manrope",children:"Saved"})]})})]}),(0,e.jsxs)("div",{className:"flex items-center gap-1",children:[s&&(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)("button",{onClick:()=>S(s.id),className:`w-6 h-6 flex items-center justify-center rounded transition-colors ${s.isPinned?"text-amber-500":"text-krushr-gray-400 hover:text-amber-500"}`,title:s.isPinned?"Unpin":"Pin",children:(0,e.jsx)($,{className:`w-3 h-3 ${s.isPinned?"fill-current":""}`})}),(0,e.jsx)("button",{onClick:()=>v?.(s.id),className:`w-6 h-6 flex items-center justify-center rounded transition-colors ${s.isArchived?"text-krushr-primary":"text-krushr-gray-400 hover:text-krushr-primary"}`,title:s.isArchived?"Unarchive":"Archive",children:(0,e.jsx)(V,{className:"w-3 h-3"})}),(0,e.jsxs)("div",{className:"relative",children:[(0,e.jsx)("button",{onClick:()=>d(!h),className:"w-6 h-6 flex items-center justify-center rounded transition-colors text-krushr-gray-400 hover:text-krushr-gray-600",title:"Color",children:(0,e.jsx)(G,{className:"w-3 h-3"})}),h&&(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)("div",{className:"fixed inset-0 z-40",onClick:()=>d(!1)}),(0,e.jsx)("div",{className:"absolute top-full right-0 mt-1 bg-white border border-krushr-gray-200 rounded-lg shadow-xl p-2 z-50",children:(0,e.jsx)("div",{style:{display:"grid",gridTemplateColumns:"repeat(4, 1fr)",gap:"4px"},children:F.map(g=>(0,e.jsx)("button",{onClick:()=>{f(s.id,g.value),d(!1)},className:`w-6 h-6 rounded border hover:scale-110 transition-transform ${z(s).value===g.value?"border-krushr-primary ring-2 ring-krushr-primary/30":"border-krushr-gray-300 hover:border-krushr-primary/50"}`,style:{backgroundColor:g.bgValue},title:g.name},g.value))})})]})]})]}),(0,e.jsx)("button",{onClick:l,disabled:u,className:"w-6 h-6 text-krushr-gray-400 hover:text-red-500 rounded flex items-center justify-center transition-colors disabled:opacity-50",title:"Delete",children:u?(0,e.jsx)("div",{className:"w-3 h-3 border border-red-500 border-t-transparent rounded-full animate-spin"}):(0,e.jsx)(X,{className:"w-3 h-3"})})]})]})})}var te=n.default.forwardRef(({workspaceId:o,className:a},l)=>{let[r,u]=(0,n.useState)(null),[s,S]=(0,n.useState)(""),[f,v]=(0,n.useState)(""),[N,y]=(0,n.useState)(""),[m,h]=(0,n.useState)(null),[d,g]=(0,n.useState)(!1),[T,I]=(0,n.useState)(!1),P=(0,n.useRef)(null),R=ee(),x=b.notes.list.useQuery({workspaceId:o,search:s||void 0}),w=b.notes.get.useQuery({id:r},{enabled:!!r}),j=b.notes.create.useMutation({onSuccess:t=>{u(t.id),v(t.title),y(t.content||""),x.refetch(),c.success("Note created")}}),O=b.notes.update.useMutation({onSuccess:()=>{x.refetch(),w.refetch()}}),Q=b.notes.delete.useMutation({onSuccess:()=>{u(null),v(""),y(""),x.refetch(),c.success("Note deleted")}}),re=b.notes.togglePin.useMutation({onSuccess:()=>{x.refetch(),w.refetch(),c.success("Note pin status updated")},onError:t=>{c.error("Failed to update pin status")}}),oe=b.notes.toggleArchive.useMutation({onSuccess:()=>{x.refetch(),w.refetch(),c.success("Note archive status updated")},onError:t=>{c.error("Failed to update archive status")}}),ne=()=>{try{let t=k.filter(L=>!L.isArchived),i="# Notes Export\\n\\n";t.forEach(L=>{i+=`## ${L.title}\\n\\n`,i+=`${L.content||"No content"}\\n\\n`,i+=`*Updated: ${new Date(L.updatedAt).toLocaleDateString()}*\\n\\n`,i+="---\\n\\n"});let A=new Blob([i],{type:"text/markdown"}),C=URL.createObjectURL(A),E=document.createElement("a");E.href=C,E.download=`notes-export-${new Date().toISOString().split("T")[0]}.md`,document.body.appendChild(E),E.click(),document.body.removeChild(E),URL.revokeObjectURL(C),c.success("Notes exported successfully")}catch{c.error("Failed to export notes")}},me=b.notes.update.useMutation({onSuccess:()=>{x.refetch(),c.success("Note folder updated")},onError:t=>{c.error("Failed to update note folder")}});(0,n.useEffect)(()=>{w.data&&(v(w.data.title),y(w.data.content||""))},[w.data]),(0,n.useEffect)(()=>{let t=()=>{if(P.current){let A=P.current.offsetWidth,C=A<600||R;g(C),C&&r&&!T&&I(!0),console.log("Notes panel size check:",{width:A,shouldBeSingleColumn:C,isMobile:R,activeNoteId:r,showEditor:T})}};t();let i=new ResizeObserver(t);return P.current&&i.observe(P.current),()=>i.disconnect()},[r,R,T]),(0,n.useEffect)(()=>{if(r&&(f||N)){m&&clearTimeout(m);let t=setTimeout(()=>{O.mutate({id:r,title:f||"Untitled",content:N})},1e3);h(t)}return()=>{m&&clearTimeout(m)}},[f,N,r]);let W=()=>{j.mutate({title:"New Note",content:"",workspaceId:o,tags:[]})},ae=()=>{r&&confirm("Delete this note?")&&Q.mutate({id:r})},se=t=>{u(t.id),d&&I(!0)},ie=()=>{I(!1),u(null)},le=t=>{re.mutate({id:t})},H=t=>{oe.mutate({id:t})},de=(t,i)=>{O.mutate({id:t,color:i}),c.success("Note color updated")},k=x.data?.notes||[];return(0,e.jsxs)("div",{ref:P,className:p("flex h-full bg-krushr-gray-50",a),children:[(0,e.jsxs)("div",{className:p("bg-white flex flex-col shadow-sm transition-all duration-300",d?T?"hidden":"w-full":"w-80 border-r border-krushr-gray-200"),children:[(0,e.jsx)(ue,{value:s,onChange:S,onCreateNote:W,isCreating:j.isPending}),(0,e.jsx)("div",{className:"flex-1 overflow-y-auto",children:x.isLoading?(0,e.jsx)("div",{className:"flex items-center justify-center py-8",children:(0,e.jsx)("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-krushr-primary"})}):k.length===0?(0,e.jsxs)("div",{className:"p-6 text-center",children:[(0,e.jsx)("div",{className:"w-10 h-10 bg-krushr-gray-100 rounded-full flex items-center justify-center mx-auto mb-2",children:(0,e.jsx)(K,{className:"w-5 h-5 text-krushr-gray-400"})}),(0,e.jsx)("p",{className:"text-gray-900 font-medium font-brand",children:"No notes found"}),(0,e.jsx)("p",{className:"text-gray-400 text-sm mt-1 font-manrope",children:s?"Try different keywords":"Create your first note"})]}):(0,e.jsx)("div",{className:"p-2",children:k.map((t,i)=>(0,e.jsx)(ce,{note:t,isActive:r===t.id,onClick:()=>se(t),isFirst:i===0,isLast:i===k.length-1,onArchiveToggle:H},t.id))})})]}),(0,e.jsx)("div",{className:p("flex flex-col transition-all duration-300",d?T?"w-full":"hidden":"flex-1"),children:r?(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(fe,{title:f,onTitleChange:v,onDelete:ae,isSaving:O.isPending,isDeleting:Q.isPending,note:k.find(t=>t.id===r),onPin:le,onColorChange:de,onArchive:H,onExport:ne,isSingleColumn:d,onBack:ie}),(0,e.jsx)("div",{className:"flex-1 p-3",style:{backgroundColor:r?z(k.find(t=>t.id===r)||{}).bgValue:"#ffffff"},children:(0,e.jsx)("textarea",{value:N,onChange:t=>y(t.target.value),placeholder:"Start writing your note...",className:p("w-full h-full min-h-[400px] border-0 outline-none resize-none bg-transparent","font-manrope text-sm text-gray-700 placeholder:text-gray-400")})})]}):(0,e.jsx)("div",{className:"flex-1 flex items-center justify-center",style:{backgroundColor:"#ffffff"},children:(0,e.jsxs)("div",{className:"text-center max-w-md mx-auto p-6",children:[(0,e.jsx)("div",{className:"w-16 h-16 bg-gradient-to-br from-krushr-primary/10 to-krushr-primary/20 rounded-full flex items-center justify-center mx-auto mb-4",children:(0,e.jsx)(J,{className:"w-8 h-8 text-krushr-primary"})}),(0,e.jsx)("h3",{className:p("font-medium text-gray-900 mb-2 font-manrope",d?"text-base":"text-lg"),children:"Select a note to edit"}),(0,e.jsx)("p",{className:p("text-gray-500 leading-relaxed mb-4 font-manrope",d?"text-xs":"text-sm"),children:d?"Tap a note to start editing":"Choose a note from the sidebar to start editing, or create a new note to get started."}),!d&&(0,e.jsx)("button",{onClick:W,disabled:j.isPending,className:"w-8 h-8 bg-krushr-primary text-white rounded-md flex items-center justify-center hover:bg-krushr-primary/90 disabled:opacity-50 transition-colors",title:"Create your first note",children:(0,e.jsx)(U,{className:"w-4 h-4"})})]})})})]})});te.displayName="NotesPanel";var ye=te;export{ye as a};
